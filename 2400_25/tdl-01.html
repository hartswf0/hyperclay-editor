<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Course OS â€” Spencerâ€‘Brown Olog Builder</title>
<style>
  :root{
    --bg:#0b0c10;--panel:#101625;--ink:#e9ecf1;--mute:#9aabc7;--rule:#1f2738;--chip:#1b2334;--accent:#3aa7ff;--ok:#28d07f;--warn:#f3c211;--bad:#e74c3c;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:13.5px/1.45 ui-sans-serif,system-ui,Segoe UI,Inter,Roboto}
  .row{display:flex;gap:10px;height:100%;}
  .col{background:var(--panel);border:1px solid var(--rule);border-radius:12px;padding:10px;overflow:auto}
  #left{width:320px}
  #center{flex:1;display:flex;flex-direction:column}
  #right{width:360px}
  header{display:flex;align-items:center;gap:12px;padding:10px 12px;background:#0f131c;border-bottom:1px solid var(--rule)}
  header h1{font-size:16px;margin:0;font-weight:700}
  .bar{display:flex;align-items:center;gap:8px;margin-left:auto}
  .btn{background:var(--chip);border:1px solid var(--rule);padding:6px 10px;border-radius:10px;color:var(--ink);cursor:pointer}
  .btn:hover{background:#202b40}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .pill{display:inline-flex;align-items:center;gap:6px;background:#142038;border:1px solid var(--rule);padding:4px 8px;border-radius:999px;margin:2px 3px}
  .sect{margin-bottom:12px}
  h2{font-size:13px;margin:0 0 6px 0;color:var(--mute);text-transform:uppercase;letter-spacing:.08em}
  .slot{border:1px dashed var(--rule);border-radius:10px;padding:6px;margin:4px 0}
  .card{display:flex;justify-content:space-between;align-items:center;background:var(--chip);border:1px solid var(--rule);border-radius:10px;padding:6px 8px;margin:6px 0}
  .tiny{font-size:12px;color:var(--mute)}
  input,select{background:#0f1526;border:1px solid var(--rule);color:var(--ink);padding:6px 8px;border-radius:8px}
  textarea{background:#0f1526;border:1px solid var(--rule);color:var(--ink);padding:8px;border-radius:10px;width:100%;height:90px}
  .rowline{display:flex;gap:8px;align-items:center}
  .badge{background:#0f192e;border:1px solid var(--rule);padding:2px 6px;border-radius:8px;color:var(--mute)}
  .kbd{background:#0d1220;border:1px solid var(--rule);padding:1px 6px;border-radius:6px}
  .hr{height:1px;background:var(--rule);margin:8px 0}
  .scroll{max-height:210px;overflow:auto}
  .ok{color:var(--ok)}.warn{color:var(--warn)}.bad{color:var(--bad)}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
</style>
</head>
<body>
<header>
  <h1>Course OS â€” Spencerâ€‘Brown Olog Builder</h1>
  <div class="bar">
    <span class="badge">Weeks: <span id="weeksTotal">14</span></span>
    <span class="badge">Midterm: wk <span id="midW">7</span></span>
    <span class="badge">Final: wk <span id="finW">14</span></span>
    <span class="badge">Weights: P10 / R25 / L10 / M25 / F35</span>
    <button class="btn" id="exportBtn">Export .json</button>
    <button class="btn" id="resetBtn">Reset</button>
  </div>
</header>
<div class="row" style="height:calc(100% - 52px)">
  <!-- LEFT: REGISTERS -->
  <div class="col" id="left">
    <div class="sect">
      <h2>Registers (â—»)</h2>
      <div class="tiny">These are first-order <b>distinctions</b> with slot capacities inspired by your symbol ledger. Click a plus to spawn a card into the workspace.</div>
    </div>

    <div class="sect" id="reg-frames">
      <div class="rowline"><strong>ğ“‰— Ã—10 â€” Frames</strong><span class="tiny">(core lenses)</span></div>
      <div id="framesList" class="scroll"></div>
    </div>

    <div class="sect" id="reg-methods">
      <div class="rowline"><strong>ğ“ƒ‘ Ã—6 â€” Methods</strong><span class="tiny">(ways of knowing)</span></div>
      <div id="methodsList" class="scroll"></div>
    </div>

    <div class="sect" id="reg-weeks">
      <div class="rowline"><strong>â–‘/â–’/â–“ Ã—14 â€” Weekly Ledgers</strong><span class="tiny">(reflection / seminar / practice)</span></div>
      <div class="grid tiny" id="weeksGrid"></div>
    </div>

    <div class="sect" id="reg-ops">
      <div class="rowline"><strong>â¿°â¿±â¿²â¿³â¿´â¿µâ¿¶â¿·â¿¸â¿¹â¿ºâ¿» â€” Composition Ops</strong><span class="tiny">(choose when linking)</span></div>
      <div class="tiny">â¿° sideâ€‘byâ€‘side Â· â¿± overâ€‘under Â· â¿² interleave Â· â¿³ tripleâ€‘stack Â· â¿´ enclosure Â· â¿µ topâ€‘enclose Â· â¿¶ bottomâ€‘enclose Â· â¿· leftâ€‘enclose Â· â¿¸ cornerâ€‘enclose Â· â¿¹ sweep Â· â¿º followâ€‘tail Â· â¿» overlay</div>
    </div>

    <div class="sect" id="reg-forms">
      <div class="rowline"><strong>âââ‘â’ â€” Artifact Forms</strong><span class="tiny">(note, sketch, essay, media)</span></div>
      <div id="formsList" class="scroll"></div>
    </div>

    <div class="sect" id="reg-instruments">
      <div class="rowline"><strong>âŒ¸âŒ¹ââ‚âƒâ„ â€” Instruments</strong><span class="tiny">(timeline, hypertext, graph, matrix, tree, flow)</span></div>
      <div id="instList" class="scroll"></div>
    </div>
  </div>

  <!-- CENTER: WORKSPACE (STATE) -->
  <div class="col" id="center">
    <div class="sect">
      <h2>State Workspace â€” Week <span id="weekLabel">1</span></h2>
      <div class="tiny">Spawn cards here, then link â—» â†’ â—» using an operator to build your <b>olog</b> for this weekâ€™s teaching reality.</div>
      <div class="hr"></div>
      <div id="workspace" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;min-height:180px"></div>
    </div>
    <div class="sect">
      <h2>Olog (objects â—» and morphisms â†’)</h2>
      <div class="rowline tiny">
        <select id="fromSel"></select>
        <span>â†’</span>
        <select id="toSel"></select>
        <select id="opSel"></select>
        <button class="btn" id="linkBtn">Add Morphism</button>
      </div>
      <div class="hr"></div>
      <div id="ologList" class="scroll"></div>
    </div>
    <div class="sect">
      <h2>Notes</h2>
      <textarea id="notes" placeholder="Observations, Î´ (surprises), planned policy tweak for week t+1..."></textarea>
    </div>
  </div>

  <!-- RIGHT: INSPECTOR / INDEX -->
  <div class="col" id="right">
    <div class="sect">
      <h2>Inspector</h2>
      <div id="inspector">Select a card to see/edit metadata.</div>
    </div>
    <div class="sect">
      <h2>Spencerâ€‘Brown Index</h2>
      <div class="tiny">Formal first distinctions and indications for this OS.</div>
      <div class="hr"></div>
      <div class="mono tiny" id="sbIndex"></div>
    </div>
    <div class="sect">
      <h2>Ledger</h2>
      <div id="ledger" class="tiny"></div>
    </div>
  </div>
</div>

<script>
// ======== Data model ========
const CONFIG = {
  weeks:14, midterm:7, final:14,
  weights:{participation:0.10, reflections:0.25, leader:0.10, midterm:0.25, final:0.35}
};

const FRAMES = [
  'Medium-as-Extension ğ“‰—1','Culture/Meaning ğ“‰—2','Mythos/Ideology ğ“‰—3','Bias/Format ğ“‰—4','Interface/Protocol ğ“‰—5',
  'Platform/Network ğ“‰—6','Algorithm/Data ğ“‰—7','Infrastructure ğ“‰—8','Authorship/Agency ğ“‰—9','Attention/Economy ğ“‰—10'
];
const METHODS = ['Close Reading ğ“ƒ‘1','Thick Description ğ“ƒ‘2','Systems Mapping ğ“ƒ‘3','TD Learning ğ“ƒ‘4','Form/Content ğ“ƒ‘5','Ethnography ğ“ƒ‘6'];
const FORMS = ['â Note','â Sketch','â‘ Essay','â’ Media'];
const INSTRUMENTS = ['âŒ¸ Timeline','âŒ¹ Hypertext','â Graph','â‚ Matrix','âƒ Tree','â„ Flow'];
const OPS = ['â¿° side-by-side','â¿± over-under','â¿² interleave','â¿³ triple-stack','â¿´ enclosure','â¿µ top-enclose','â¿¶ bottom-enclose','â¿· left-enclose','â¿¸ corner','â¿¹ sweep','â¿º follow','â¿» overlay'];

// per-week state
let STATE = Array.from({length:CONFIG.weeks},()=>({cards:[], olog:[], notes:''}));
let WEEK = 1;
let CARD_ID = 0;

function $(id){return document.getElementById(id)}

// ======== Registers UI ========
function renderRegisters(){
  const mkRow=(label, arr, mountId)=>{
    const mount=$(mountId); mount.innerHTML='';
    arr.forEach(name=>{
      const row=document.createElement('div'); row.className='card';
      row.innerHTML=`<span>${name}</span><button class="btn" data-spawn="${name}">ï¼‹</button>`;
      mount.appendChild(row);
    });
    mount.addEventListener('click',e=>{
      const t=e.target.closest('button[data-spawn]'); if(!t) return; spawnCard(t.dataset.spawn);
    });
  }
  mkRow('Frames', FRAMES, 'framesList');
  mkRow('Methods', METHODS, 'methodsList');
  mkRow('Forms', FORMS, 'formsList');
  mkRow('Instruments', INSTRUMENTS, 'instList');

  // weeks mini-grid
  const wg=$('weeksGrid'); wg.innerHTML='';
  for(let i=1;i<=CONFIG.weeks;i++){
    const b=document.createElement('button'); b.className='btn'; b.textContent=i; b.style.padding='6px 0'; b.onclick=()=>{WEEK=i; $('weekLabel').textContent=WEEK; renderWorkspace(); renderOlog(); renderLedger();};
    wg.appendChild(b);
  }
}

// ======== Workspace ========
function spawnCard(label){
  const id = `c${++CARD_ID}`;
  const card = {id,label,meta:{role:'â—»',form:null,instrument:null,week:WEEK}};
  STATE[WEEK-1].cards.push(card);
  renderWorkspace(); renderOlog(); renderInspector(card); renderLedger();
}

function renderWorkspace(){
  const area=$('workspace'); area.innerHTML='';
  const cards=STATE[WEEK-1].cards;
  cards.forEach(c=>{
    const el=document.createElement('div'); el.className='card'; el.dataset.id=c.id;
    el.innerHTML=`<div><strong>â—» ${c.label}</strong><div class="tiny">id:${c.id} Â· wk ${c.meta.week}</div></div>
    <div class="rowline tiny">
      <select data-form>
        <option value="">â€” form â€”</option>
        ${FORMS.map(f=>`<option ${c.meta.form===f?'selected':''}>${f}</option>`).join('')}
      </select>
      <select data-inst>
        <option value="">â€” instrument â€”</option>
        ${INSTRUMENTS.map(f=>`<option ${c.meta.instrument===f?'selected':''}>${f}</option>`).join('')}
      </select>
      <button class="btn" data-del>Delete</button>
    </div>`;
    el.onclick=()=>renderInspector(c);
    el.querySelector('[data-del]').onclick=(e)=>{ e.stopPropagation(); removeCard(c.id); };
    el.querySelector('[data-form]').onchange=(e)=>{ c.meta.form=e.target.value||null; renderInspector(c); };
    el.querySelector('[data-inst]').onchange=(e)=>{ c.meta.instrument=e.target.value||null; renderInspector(c); };
    area.appendChild(el);
  });
}

function removeCard(id){
  STATE[WEEK-1].cards = STATE[WEEK-1].cards.filter(c=>c.id!==id);
  STATE.forEach(w=>{ w.olog = w.olog.filter(m=>m.from!==id && m.to!==id); });
  renderWorkspace(); renderOlog(); renderInspector(null); renderLedger();
}

// ======== Olog builder ========
function renderOlog(){
  const cards=STATE[WEEK-1].cards;
  const fromSel=$('fromSel'), toSel=$('toSel'), opSel=$('opSel');
  fromSel.innerHTML = cards.map(c=>`<option value="${c.id}">â—» ${c.label} (${c.id})</option>`).join('');
  toSel.innerHTML = fromSel.innerHTML;
  opSel.innerHTML = OPS.map(o=>`<option>${o}</option>`).join('');

  $('linkBtn').onclick=()=>{
    if(!cards.length) return;
    const from=fromSel.value, to=toSel.value, op=opSel.value;
    if(from===to) return alert('Pick two different objects.');
    STATE[WEEK-1].olog.push({from,to,op});
    renderOlogList(); renderLedger();
  };
  renderOlogList();
}

function renderOlogList(){
  const mount=$('ologList'); mount.innerHTML='';
  const cards=Object.fromEntries(STATE[WEEK-1].cards.map(c=>[c.id,c]));
  STATE[WEEK-1].olog.forEach((m,i)=>{
    const row=document.createElement('div'); row.className='card';
    const a=cards[m.from]?.label||m.from, b=cards[m.to]?.label||m.to;
    row.innerHTML=`<span>â—» ${a} <b>â†’</b> â—» ${b} <span class="tiny">(${m.op})</span></span>
                   <button class="btn" data-i="${i}">Remove</button>`;
    row.querySelector('button').onclick=()=>{ STATE[WEEK-1].olog.splice(i,1); renderOlogList(); renderLedger(); };
    mount.appendChild(row);
  });
}

// ======== Inspector ========
function renderInspector(card){
  const box=$('inspector');
  if(!card){ box.textContent='Select a card to see/edit metadata.'; return; }
  box.innerHTML = `<div class="mono">id: ${card.id}</div>
  <div><b>Label:</b> ${card.label}</div>
  <div><b>Week:</b> ${card.meta.week}</div>
  <div><b>Form:</b> ${card.meta.form||'â€”'}</div>
  <div><b>Instrument:</b> ${card.meta.instrument||'â€”'}</div>
  <div class="hr"></div>
  <div class="tiny">Spencerâ€‘Brown: this card is a <b>marked form</b> â—» within this weekâ€™s distinction. Use morphisms (â†’) to indicate how it composes with others via an operator (â¿° etc.).</div>`;
}

// ======== SB Index + Ledger ========
function renderSBIndex(){
  const text = `First Distinction (â—»): Week state.\n`+
  `Mark (â—») classes:\n`+
  `  ğ“‰— Frames Ã—10  â†’ lenses for interpreting artifacts.\n`+
  `  ğ“ƒ‘ Methods Ã—6  â†’ procedures for knowing.\n`+
  `  âââ‘â’ Forms    â†’ externalizations.\n`+
  `  âŒ¸âŒ¹ââ‚âƒâ„ Instruments â†’ ways of arranging evidence.\n`+
  `Indications (â†’): Morphisms typed by ops (â¿°/â¿±/â€¦/â¿») that compose â—» to â—» to form an olog.\n`+
  `Composites: (Frame â—») âŸ¶ (Method â—») âŸ¶ (Form â—») âŸ¶ (Instrument â—») âŸ¶ Artifact â—».\n`+
  `Evaluation: mapped to weekly ledgers â–‘ reflection / â–’ seminar / â–“ practice.`;
  $('sbIndex').textContent = text;
}

function renderLedger(){
  const w = STATE[WEEK-1];
  const parts = [
    `â—» objects: ${w.cards.length}`,
    `â†’ morphisms: ${w.olog.length}`,
    `notes chars: ${(w.notes||'').length}`
  ];
  $('ledger').innerHTML = parts.map(p=>`<div>â€¢ ${p}</div>`).join('');
}

// ======== Export/Reset/Notes ========
$('exportBtn').onclick=()=>{
  const out = {config:CONFIG, state:STATE};
  const blob = new Blob([JSON.stringify(out,null,2)],{type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'course-os-olog.json'; a.click();
};
$('resetBtn').onclick=()=>{ if(confirm('Reset workspace?')) location.reload(); };
$('notes').addEventListener('input', e=>{ STATE[WEEK-1].notes = e.target.value; renderLedger(); });

// ======== Init ========
(function init(){
  $('weekLabel').textContent = WEEK;
  renderRegisters();
  renderWorkspace();
  renderOlog();
  renderSBIndex();
  renderLedger();
})();
</script>
</body>
</html>
