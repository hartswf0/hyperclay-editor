<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HYPERCLAY — Quad Cinema</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Georgia', 'Times New Roman', serif;
  background: #000;
  color: #e8e8e8;
  overflow: hidden;
  height: 100vh;
}

.app {
  display: flex;
  flex-direction: column;
  height: 100vh;
}

/* Control Bar */
.control-bar {
  background: #0b0b0c;
  border-bottom: 1px solid #2a2a2c;
  padding: 8px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 100;
}

.title {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1.5px;
  color: #666;
  margin-right: auto;
  font-family: monospace;
  text-transform: uppercase;
}

.btn {
  background: #1a1a1c;
  border: 1px solid #333;
  padding: 5px 12px;
  font-size: 10px;
  color: #999;
  cursor: pointer;
  font-family: monospace;
  font-weight: 600;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.btn:hover {
  background: #2a2a2c;
  border-color: #555;
  color: #ccc;
}

.btn.active {
  background: #2a2a2c;
  color: #fff;
  border-color: #555;
}

.btn.play {
  background: #222;
  border-color: #444;
  color: #fff;
  font-size: 10px;
  padding: 5px 16px;
  font-weight: 700;
}

.btn.play:hover {
  background: #2a2a2c;
  border-color: #666;
}

.btn.play.active {
  background: #0a0;
  border-color: #0c0;
  color: #000;
}

/* Main Content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Quad Grid */
.quad-grid {
  flex: 1;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 1px;
  background: #2a2a2c;
  padding: 0;
  min-height: 0;
}

.quad-panel {
  background: #000;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

.panel-label {
  position: absolute;
  top: 8px;
  left: 8px;
  background: rgba(0, 0, 0, 0.85);
  color: #999;
  padding: 3px 8px;
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 10;
  font-family: monospace;
  text-transform: uppercase;
}

.media-container {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
  position: relative;
  min-height: 0;
}

.media-container img,
.media-container video {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.no-media {
  color: #444;
  font-size: 11px;
  font-family: monospace;
  text-align: center;
}

/* Text Panel */
.text-panel {
  background: #1a1a1c;
  border-top: 1px solid #333;
  padding: 16px 24px;
  max-height: 25vh;
  overflow-y: auto;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  align-items: start;
}

.text-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.text-label {
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: #666;
  font-family: monospace;
  border-bottom: 1px solid #2a2a2c;
  padding-bottom: 3px;
}

.text-content {
  font-size: 16px;
  line-height: 1.6;
  color: #e8e8e8;
  font-family: 'Helvetica Neue', Arial, sans-serif;
  font-weight: 400;
}

.text-content.fragment {
  font-style: italic;
  color: #bbb;
  font-size: 16px;
  font-weight: 300;
}

.text-content.shot-desc {
  color: #fff;
  font-weight: 500;
  font-size: 16px;
}

.text-content.elements {
  color: #fff;
  font-size: 15px;
  font-family: 'Helvetica Neue', Arial, sans-serif;
  font-weight: 700;
  letter-spacing: 0.8px;
}

/* Timeline */
.timeline-container {
  background: #0b0b0c;
  border-top: 1px solid #2a2a2c;
  height: 100px;
  display: flex;
  flex-direction: column;
}

.timeline-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 12px;
  background: #1a1a1c;
  border-bottom: 1px solid #333;
}

.screenplay-select {
  display: flex;
  gap: 6px;
}

.screenplay-btn {
  background: #2a2a2c;
  border: 2px solid #444;
  padding: 4px 10px;
  font-size: 10px;
  color: #aaa;
  cursor: pointer;
  font-weight: 700;
  transition: all 0.2s;
  font-family: monospace;
}

.screenplay-btn:hover {
  border-color: #666;
}

.screenplay-btn.active {
  background: #2a2a2c;
  color: #fff;
  border-color: #555;
}

.timeline-shots {
  flex: 1;
  display: flex;
  gap: 6px;
  padding: 8px;
  overflow-x: auto;
  overflow-y: hidden;
  align-items: center;
}

.timeline-thumb {
  flex-shrink: 0;
  width: 120px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}

.timeline-thumb:hover {
  transform: translateY(-3px);
}

.timeline-thumb.active {
  transform: scale(1.15) translateY(-5px);
}

.thumb-img {
  width: 100%;
  aspect-ratio: 16/9;
  background: #1a1a1c;
  border: 2px solid #444;
  position: relative;
  overflow: hidden;
  transition: all 0.2s;
}

.timeline-thumb.active .thumb-img {
  border-color: #fff;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
}

.thumb-img img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.thumb-number {
  position: absolute;
  top: 3px;
  left: 3px;
  background: rgba(0, 0, 0, 0.85);
  color: #999;
  padding: 2px 6px;
  font-size: 9px;
  font-weight: 700;
  border: 1px solid rgba(255, 255, 255, 0.1);
  font-family: monospace;
}

/* Progress Bar */
.progress-bar {
  height: 4px;
  background: #1a1a1c;
  position: relative;
  cursor: pointer;
}

.progress-fill {
  height: 100%;
  background: #fff;
  transition: width 0.3s;
}

/* Navigation Arrows */
.nav-arrows {
  position: fixed;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  display: flex;
  justify-content: space-between;
  padding: 0 20px;
  pointer-events: none;
  z-index: 50;
}

.nav-btn {
  background: rgba(26, 26, 28, 0.95);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #999;
  font-size: 28px;
  width: 50px;
  height: 50px;
  cursor: pointer;
  pointer-events: all;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-family: monospace;
}

.nav-btn:hover {
  background: rgba(42, 42, 44, 0.95);
  border-color: rgba(255, 255, 255, 0.4);
  color: #fff;
  transform: scale(1.05);
}

.nav-btn:disabled {
  opacity: 0.2;
  cursor: not-allowed;
}

/* Status */
.status {
  position: fixed;
  top: 50px;
  right: 20px;
  background: rgba(0, 0, 0, 0.85);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 6px 10px;
  font-size: 9px;
  font-family: monospace;
  color: #666;
  z-index: 60;
}

/* Loading */
.loading {
  font-size: 12px;
  color: #666;
  font-family: monospace;
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #0b0b0c;
}

::-webkit-scrollbar-thumb {
  background: #444;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #666;
}
</style>
</head>
<body>

<div class="app">
  <!-- Control Bar -->
  <div class="control-bar">
    <div class="title">HYPERCLAY — QUAD CINEMA</div>
    <button class="btn play" id="play-btn">▶ PLAY</button>
    <button class="btn" id="text-toggle">HIDE TEXT</button>
    <button class="btn" id="fullscreen-btn">FULLSCREEN</button>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Quad Grid -->
    <div class="quad-grid">
      <!-- Dynamic Image -->
      <div class="quad-panel">
        <div class="panel-label">Dynamic — Image</div>
        <div class="media-container" id="dynamic-image">
          <div class="loading">Loading...</div>
        </div>
      </div>

      <!-- Dynamic Video -->
      <div class="quad-panel">
        <div class="panel-label">Dynamic — Video</div>
        <div class="media-container" id="dynamic-video">
          <div class="loading">Loading...</div>
        </div>
      </div>

      <!-- Hand-drawn Image -->
      <div class="quad-panel">
        <div class="panel-label">Hand-drawn — Image</div>
        <div class="media-container" id="handdrawn-image">
          <div class="loading">Loading...</div>
        </div>
      </div>

      <!-- Hand-drawn Video -->
      <div class="quad-panel">
        <div class="panel-label">Hand-drawn — Video</div>
        <div class="media-container" id="handdrawn-video">
          <div class="loading">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Text Panel -->
    <div class="text-panel" id="text-panel">
      <div class="text-section">
        <div class="text-label">Fragment</div>
        <div class="text-content fragment" id="text-fragment"></div>
      </div>
      
      <div class="text-section">
        <div class="text-label">Shot</div>
        <div class="text-content shot-desc" id="text-shot"></div>
      </div>
      
      <div class="text-section">
        <div class="text-label">Elements</div>
        <div class="text-content elements" id="text-elements"></div>
      </div>
      
      <div class="text-section">
        <div class="text-label">Scene</div>
        <div class="text-content" id="text-scene"></div>
      </div>
    </div>
  </div>

  <!-- Timeline -->
  <div class="timeline-container">
    <div class="timeline-header">
      <div class="screenplay-select" id="screenplay-select"></div>
      <div style="font-size: 9px; color: #555; font-family: monospace; text-transform: uppercase; letter-spacing: 0.5px;">
        <span id="shot-counter">1 / 0</span> • 
        <span id="total-counter">0 TOTAL</span>
      </div>
    </div>
    <div class="timeline-shots" id="timeline-shots"></div>
    <div class="progress-bar" id="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-arrows">
    <button class="nav-btn" id="prev-btn">‹</button>
    <button class="nav-btn" id="next-btn">›</button>
  </div>

  <!-- Status -->
  <div class="status" id="status">
    <div>Keyboard: ← → SPACE F T</div>
  </div>
</div>

<script>
// State
const state = {
  screenplays: [],
  allShots: [],
  currentShot: 0,
  currentScreenplay: null,
  playing: false,
  playInterval: null,
  textVisible: true,
  shotDuration: 4000
};

// Load data
async function loadData() {
  try {
    const response = await fetch('screenplays.json');
    const data = await response.json();
    
    data.forEach(screenplay => {
      const shots = [];
      
      screenplay.content.forEach((item, i) => {
        if (item.shot_number) {
          const prevFragment = i > 0 && screenplay.content[i-1].fragment ? 
            screenplay.content[i-1].fragment : '';
          
          shots.push({
            screenplay: screenplay.title,
            shotNumber: item.shot_number,
            shotDesc: item.shot_description || '',
            staticDesc: item.static_scene_description || '',
            temporalDesc: item.temporal_scene_description || '',
            fragment: prevFragment,
            elements: item.scene_story_elements || [],
            versions: item.versions || {}
          });
        }
      });
      
      state.screenplays.push({
        title: screenplay.title,
        shots: shots
      });
      
      state.allShots.push(...shots);
    });
    
    console.log(`Loaded ${state.screenplays.length} screenplays, ${state.allShots.length} shots`);
    init();
  } catch (error) {
    console.error('Failed to load:', error);
  }
}

// Initialize
function init() {
  renderScreenplaySelect();
  renderTimeline();
  showShot(0);
  setupControls();
}

// Get visible shots
function getVisibleShots() {
  if (state.currentScreenplay === null) return state.allShots;
  const sp = state.screenplays.find(s => s.title === state.currentScreenplay);
  return sp ? sp.shots : [];
}

// Show shot
function showShot(index) {
  const shots = getVisibleShots();
  if (index < 0 || index >= shots.length) return;
  
  state.currentShot = index;
  const shot = shots[index];
  
  // Render all four panels
  renderPanel('dynamic-image', shot, 'dynamic_style', 'image');
  renderPanel('dynamic-video', shot, 'dynamic_style', 'video');
  renderPanel('handdrawn-image', shot, 'handdrawn_ink_style', 'image');
  renderPanel('handdrawn-video', shot, 'handdrawn_ink_style', 'video');
  
  // Update text
  updateText(shot);
  
  // Update UI
  updateProgress();
  updateTimeline();
  updateCounters();
}

// Render individual panel
function renderPanel(containerId, shot, style, mediaType) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  
  const version = shot.versions[style];
  if (!version) {
    container.innerHTML = '<div class="no-media">No media</div>';
    return;
  }
  
  const url = mediaType === 'video' ? version.selected_video_url : version.selected_image_url;
  
  if (!url) {
    container.innerHTML = '<div class="no-media">No media</div>';
    return;
  }
  
  if (mediaType === 'video') {
    const video = document.createElement('video');
    video.src = url;
    video.autoplay = true;
    video.loop = true;
    video.muted = true;
    video.controls = false;
    container.appendChild(video);
  } else {
    const img = document.createElement('img');
    img.src = url;
    container.appendChild(img);
  }
}

// Update text panel
function updateText(shot) {
  document.getElementById('text-fragment').textContent = 
    shot.fragment || 'No screenplay fragment provided.';
  
  document.getElementById('text-shot').textContent = 
    shot.shotDesc || 'No shot description provided.';
  
  document.getElementById('text-elements').textContent = 
    shot.elements.length > 0 ? shot.elements.join(' • ') : 'No scene elements specified.';
  
  document.getElementById('text-scene').textContent = 
    shot.staticDesc || shot.temporalDesc || 'No scene description provided.';
}

// Update progress
function updateProgress() {
  const shots = getVisibleShots();
  const progress = ((state.currentShot + 1) / shots.length) * 100;
  document.getElementById('progress-fill').style.width = progress + '%';
}

// Update counters
function updateCounters() {
  const shots = getVisibleShots();
  document.getElementById('shot-counter').textContent = 
    `${state.currentShot + 1} / ${shots.length}`;
  document.getElementById('total-counter').textContent = 
    `${state.allShots.length} TOTAL`;
}

// Render screenplay select
function renderScreenplaySelect() {
  const container = document.getElementById('screenplay-select');
  container.innerHTML = '';
  
  // All films button
  const allBtn = document.createElement('div');
  allBtn.className = 'screenplay-btn';
  if (state.currentScreenplay === null) allBtn.classList.add('active');
  allBtn.textContent = 'ALL FILMS';
  allBtn.onclick = () => {
    state.currentScreenplay = null;
    state.currentShot = 0;
    renderScreenplaySelect();
    renderTimeline();
    showShot(0);
  };
  container.appendChild(allBtn);
  
  // Individual screenplays
  state.screenplays.forEach(sp => {
    const btn = document.createElement('div');
    btn.className = 'screenplay-btn';
    if (state.currentScreenplay === sp.title) btn.classList.add('active');
    btn.textContent = sp.title;
    btn.onclick = () => {
      state.currentScreenplay = sp.title;
      state.currentShot = 0;
      renderScreenplaySelect();
      renderTimeline();
      showShot(0);
    };
    container.appendChild(btn);
  });
}

// Render timeline
function renderTimeline() {
  const container = document.getElementById('timeline-shots');
  container.innerHTML = '';
  
  const shots = getVisibleShots();
  
  shots.forEach((shot, index) => {
    const thumb = document.createElement('div');
    thumb.className = 'timeline-thumb';
    if (index === state.currentShot) thumb.classList.add('active');
    
    const img = document.createElement('div');
    img.className = 'thumb-img';
    
    // Use dynamic image as thumbnail
    const imageUrl = shot.versions.dynamic_style?.selected_image_url;
    if (imageUrl) {
      const imgEl = document.createElement('img');
      imgEl.src = imageUrl;
      img.appendChild(imgEl);
    }
    
    const num = document.createElement('div');
    num.className = 'thumb-number';
    num.textContent = `#${shot.shotNumber}`;
    img.appendChild(num);
    
    thumb.appendChild(img);
    
    thumb.onclick = () => {
      if (state.playing) stopPlayback();
      showShot(index);
    };
    
    container.appendChild(thumb);
  });
}

// Update timeline
function updateTimeline() {
  document.querySelectorAll('.timeline-thumb').forEach((el, i) => {
    el.classList.toggle('active', i === state.currentShot);
  });
  
  const active = document.querySelector('.timeline-thumb.active');
  if (active) {
    active.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
  }
}

// Playback
function startPlayback() {
  if (state.playing) return;
  state.playing = true;
  document.getElementById('play-btn').textContent = '⏸ PAUSE';
  document.getElementById('play-btn').classList.add('active');
  
  state.playInterval = setInterval(() => {
    const shots = getVisibleShots();
    if (state.currentShot < shots.length - 1) {
      showShot(state.currentShot + 1);
    } else {
      stopPlayback();
      showShot(0);
    }
  }, state.shotDuration);
}

function stopPlayback() {
  state.playing = false;
  document.getElementById('play-btn').textContent = '▶ PLAY';
  document.getElementById('play-btn').classList.remove('active');
  if (state.playInterval) {
    clearInterval(state.playInterval);
    state.playInterval = null;
  }
}

// Setup controls
function setupControls() {
  // Play
  document.getElementById('play-btn').onclick = () => {
    if (state.playing) stopPlayback();
    else startPlayback();
  };
  
  // Navigation
  document.getElementById('prev-btn').onclick = () => {
    if (state.currentShot > 0) {
      if (state.playing) stopPlayback();
      showShot(state.currentShot - 1);
    }
  };
  
  document.getElementById('next-btn').onclick = () => {
    const shots = getVisibleShots();
    if (state.currentShot < shots.length - 1) {
      if (state.playing) stopPlayback();
      showShot(state.currentShot + 1);
    }
  };
  
  // Text toggle
  document.getElementById('text-toggle').onclick = () => {
    state.textVisible = !state.textVisible;
    const panel = document.getElementById('text-panel');
    panel.style.display = state.textVisible ? 'block' : 'none';
    document.getElementById('text-toggle').textContent = 
      state.textVisible ? 'HIDE TEXT' : 'SHOW TEXT';
  };
  
  // Fullscreen
  document.getElementById('fullscreen-btn').onclick = () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
    } else {
      document.exitFullscreen();
    }
  };
  
  // Progress bar
  document.getElementById('progress-bar').onclick = (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const percent = x / rect.width;
    const shots = getVisibleShots();
    const index = Math.floor(percent * shots.length);
    if (state.playing) stopPlayback();
    showShot(Math.min(index, shots.length - 1));
  };
  
  // Keyboard
  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      document.getElementById('prev-btn').click();
    } else if (e.key === 'ArrowRight') {
      document.getElementById('next-btn').click();
    } else if (e.key === ' ') {
      e.preventDefault();
      document.getElementById('play-btn').click();
    } else if (e.key === 'f' || e.key === 'F') {
      document.getElementById('fullscreen-btn').click();
    } else if (e.key === 't' || e.key === 'T') {
      document.getElementById('text-toggle').click();
    }
  });
}

// Start
loadData();
</script>

</body>
</html>
