<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HYPERCLAY CINEMA — Film Assembly</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', monospace;
  background: #000;
  color: #e8e8e8;
  overflow: hidden;
  height: 100vh;
}

/* Main Layout */
.app {
  display: grid;
  grid-template-rows: 50px 1fr 200px;
  height: 100vh;
  gap: 0;
}

/* Top Bar */
.top-bar {
  background: #0b0b0c;
  border-bottom: 1px solid #333;
  display: flex;
  align-items: center;
  padding: 0 16px;
  justify-content: space-between;
  z-index: 1000;
}

.title {
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 1px;
  color: #ffd700;
}

.controls {
  display: flex;
  gap: 8px;
  align-items: center;
}

.btn {
  background: #2a2a2c;
  border: 1px solid #444;
  padding: 6px 12px;
  font-size: 11px;
  color: #e8e8e8;
  cursor: pointer;
  font-family: monospace;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  transition: all 0.2s;
}

.btn:hover {
  background: #3a3a3c;
  border-color: #666;
}

.btn.active {
  background: #ffd700;
  color: #000;
  border-color: #ffd700;
}

.btn.play {
  background: #0a0;
  border-color: #0c0;
  color: #000;
  font-weight: 700;
}

.btn.play:hover {
  background: #0c0;
}

/* Main Viewer */
.viewer {
  background: #000;
  position: relative;
  overflow: hidden;
}

.viewer-content {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.shot-display {
  max-width: 90%;
  max-height: 90%;
  position: relative;
}

.shot-display img,
.shot-display video {
  max-width: 100%;
  max-height: 100%;
  display: block;
  border: 2px solid #ffd700;
}

/* Overlay Info */
.shot-info {
  position: absolute;
  bottom: 20px;
  left: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.9);
  border: 1px solid #ffd700;
  padding: 16px;
  display: none;
  max-height: 200px;
  overflow-y: auto;
}

.shot-info.visible {
  display: block;
}

.info-title {
  font-size: 12px;
  font-weight: 700;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.info-section {
  margin-bottom: 12px;
  font-size: 11px;
  line-height: 1.6;
}

.info-label {
  color: #888;
  text-transform: uppercase;
  font-size: 9px;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}

.info-text {
  color: #ccc;
}

/* Shot Wall Container */
.shot-wall-container {
  background: #0b0b0c;
  border-top: 1px solid #333;
  overflow-y: auto;
  position: relative;
}

/* Wall Mode Toggle */
.wall-mode {
  display: flex;
  gap: 4px;
  padding: 8px 12px;
  border-bottom: 1px solid #333;
  background: #1a1a1c;
}

.wall-mode .btn {
  font-size: 10px;
  padding: 4px 8px;
}

/* Screenplay Sections */
.screenplay-section {
  padding: 12px;
  border-bottom: 1px solid #222;
}

.screenplay-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
  cursor: pointer;
  padding: 4px 0;
}

.screenplay-title {
  font-size: 12px;
  font-weight: 700;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.screenplay-count {
  font-size: 10px;
  color: #888;
}

.collapse-icon {
  font-size: 10px;
  color: #666;
  transition: transform 0.2s;
}

.screenplay-section.collapsed .collapse-icon {
  transform: rotate(-90deg);
}

.screenplay-section.collapsed .shot-grid {
  display: none;
}

/* Shot Grid */
.shot-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 8px;
  margin-top: 8px;
}

.shot-card {
  background: #1a1a1c;
  border: 2px solid #333;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}

.shot-card:hover {
  border-color: #ffd700;
  transform: scale(1.02);
}

.shot-card.active {
  border-color: #0a0;
  box-shadow: 0 0 10px rgba(0, 170, 0, 0.5);
}

.shot-thumb {
  aspect-ratio: 16/9;
  overflow: hidden;
  background: #000;
  position: relative;
}

.shot-thumb img,
.shot-thumb video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.shot-number {
  position: absolute;
  top: 4px;
  left: 4px;
  background: rgba(0, 0, 0, 0.8);
  color: #ffd700;
  font-size: 10px;
  padding: 3px 6px;
  font-weight: 700;
  border: 1px solid #ffd700;
}

.shot-label {
  padding: 6px;
  font-size: 10px;
  color: #aaa;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.video-indicator {
  position: absolute;
  bottom: 4px;
  right: 4px;
  background: rgba(0, 170, 0, 0.9);
  color: #000;
  font-size: 9px;
  padding: 2px 5px;
  font-weight: 700;
  border-radius: 2px;
}

/* Timeline Strip Mode */
.timeline-strip {
  display: none;
  flex-direction: row;
  gap: 6px;
  padding: 12px;
  overflow-x: auto;
  overflow-y: hidden;
  align-items: center;
}

.timeline-strip.active {
  display: flex;
}

.timeline-strip .shot-card {
  flex-shrink: 0;
  width: 180px;
}

/* Navigation */
.nav-arrows {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  display: flex;
  justify-content: space-between;
  padding: 0 20px;
  pointer-events: none;
  z-index: 100;
}

.nav-btn {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #ffd700;
  color: #ffd700;
  font-size: 24px;
  width: 50px;
  height: 50px;
  cursor: pointer;
  pointer-events: all;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-btn:hover {
  background: #ffd700;
  color: #000;
}

.nav-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* Progress Bar */
.progress-bar {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: #222;
  z-index: 200;
}

.progress-fill {
  height: 100%;
  background: #ffd700;
  transition: width 0.3s;
}

/* Loading */
.loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 14px;
  color: #888;
  text-align: center;
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: #0b0b0c;
}

::-webkit-scrollbar-thumb {
  background: #444;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: #666;
}
</style>
</head>
<body>

<div class="app">
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="title">HYPERCLAY CINEMA</div>
    <div class="controls">
      <select id="style-select" class="btn">
        <option value="dynamic_style">Dynamic Style</option>
        <option value="handdrawn_ink_style">Hand-drawn Style</option>
      </select>
      <button class="btn" id="toggle-info">Info</button>
      <button class="btn play" id="play-btn">▶ Play Film</button>
    </div>
  </div>

  <!-- Main Viewer -->
  <div class="viewer">
    <div class="progress-bar">
      <div class="progress-fill" id="progress"></div>
    </div>
    
    <div class="viewer-content">
      <div class="shot-display" id="shot-display">
        <div class="loading">Loading screenplays...</div>
      </div>
    </div>

    <div class="shot-info" id="shot-info">
      <div class="info-title" id="info-title">Shot 1</div>
      <div class="info-section">
        <div class="info-label">Fragment</div>
        <div class="info-text" id="info-fragment"></div>
      </div>
      <div class="info-section">
        <div class="info-label">Shot Description</div>
        <div class="info-text" id="info-shot"></div>
      </div>
      <div class="info-section">
        <div class="info-label">Scene Elements</div>
        <div class="info-text" id="info-elements"></div>
      </div>
      <div class="info-section">
        <div class="info-label">Scene Description</div>
        <div class="info-text" id="info-scene"></div>
      </div>
    </div>

    <div class="nav-arrows">
      <button class="nav-btn" id="prev-btn">‹</button>
      <button class="nav-btn" id="next-btn">›</button>
    </div>
  </div>

  <!-- Shot Wall -->
  <div class="shot-wall-container">
    <div class="wall-mode">
      <button class="btn active" data-mode="grid">Grid View</button>
      <button class="btn" data-mode="timeline">Timeline View</button>
      <button class="btn" data-mode="all">All Films</button>
      <span style="margin-left: auto; font-size: 10px; color: #666;" id="shot-count">0 shots loaded</span>
    </div>
    <div id="shot-wall-content"></div>
  </div>
</div>

<script>
// State
const state = {
  screenplays: [],
  allShots: [],
  currentShot: 0,
  currentStyle: 'dynamic_style',
  wallMode: 'grid',
  playing: false,
  playInterval: null,
  infoVisible: false
};

// Load data
async function loadData() {
  try {
    const response = await fetch('screenplays.json');
    const data = await response.json();
    
    // Extract all shots from all screenplays
    data.forEach(screenplay => {
      const shots = [];
      screenplay.content.forEach((item, i) => {
        if (item.shot_number) {
          const prevFragment = i > 0 && screenplay.content[i-1].fragment ? screenplay.content[i-1].fragment : '';
          shots.push({
            screenplay: screenplay.title,
            shotNumber: item.shot_number,
            shotDesc: item.shot_description || '',
            staticDesc: item.static_scene_description || '',
            temporalDesc: item.temporal_scene_description || '',
            fragment: prevFragment,
            elements: item.scene_story_elements || [],
            versions: item.versions || {}
          });
        }
      });
      
      state.screenplays.push({
        title: screenplay.title,
        shots: shots
      });
      
      state.allShots.push(...shots);
    });
    
    console.log(`Loaded ${state.screenplays.length} screenplays, ${state.allShots.length} total shots`);
    document.getElementById('shot-count').textContent = `${state.allShots.length} shots loaded`;
    
    init();
  } catch (error) {
    console.error('Failed to load:', error);
    document.querySelector('.loading').textContent = 'Failed to load screenplays.json';
  }
}

// Initialize
function init() {
  renderShotWall();
  showShot(0);
  setupControls();
}

// Get media URL for current style
function getMediaUrl(shot, type = 'image') {
  const version = shot.versions[state.currentStyle];
  if (!version) return null;
  return type === 'video' ? version.selected_video_url : version.selected_image_url;
}

// Show specific shot
function showShot(index) {
  if (index < 0 || index >= state.allShots.length) return;
  
  state.currentShot = index;
  const shot = state.allShots[index];
  const display = document.getElementById('shot-display');
  
  // Clear previous
  display.innerHTML = '';
  
  // Try video first, fallback to image
  const videoUrl = getMediaUrl(shot, 'video');
  const imageUrl = getMediaUrl(shot, 'image');
  
  if (videoUrl) {
    const video = document.createElement('video');
    video.src = videoUrl;
    video.autoplay = true;
    video.loop = true;
    video.muted = true;
    display.appendChild(video);
  } else if (imageUrl) {
    const img = document.createElement('img');
    img.src = imageUrl;
    display.appendChild(img);
  } else {
    display.innerHTML = '<div class="loading">No media available</div>';
  }
  
  // Update info
  updateInfo(shot);
  
  // Update progress
  const progress = ((index + 1) / state.allShots.length) * 100;
  document.getElementById('progress').style.width = progress + '%';
  
  // Update active shot in wall
  document.querySelectorAll('.shot-card').forEach((card, i) => {
    card.classList.toggle('active', i === index);
  });
  
  // Scroll active shot into view
  const activeCard = document.querySelector('.shot-card.active');
  if (activeCard) {
    activeCard.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
  }
}

// Update info panel
function updateInfo(shot) {
  document.getElementById('info-title').textContent = 
    `${shot.screenplay} — Shot ${shot.shotNumber}`;
  document.getElementById('info-fragment').textContent = shot.fragment || 'N/A';
  document.getElementById('info-shot').textContent = shot.shotDesc || 'N/A';
  document.getElementById('info-elements').textContent = 
    shot.elements.length > 0 ? shot.elements.join(', ') : 'N/A';
  document.getElementById('info-scene').textContent = shot.staticDesc || shot.temporalDesc || 'N/A';
}

// Render shot wall
function renderShotWall() {
  const container = document.getElementById('shot-wall-content');
  container.innerHTML = '';
  
  if (state.wallMode === 'all') {
    // Single grid with all shots
    const grid = document.createElement('div');
    grid.className = 'shot-grid';
    grid.style.padding = '12px';
    
    state.allShots.forEach((shot, index) => {
      grid.appendChild(createShotCard(shot, index));
    });
    
    container.appendChild(grid);
    
  } else if (state.wallMode === 'timeline') {
    // Timeline strips per screenplay
    state.screenplays.forEach((screenplay, spIdx) => {
      const section = document.createElement('div');
      section.className = 'screenplay-section';
      
      const header = document.createElement('div');
      header.className = 'screenplay-header';
      header.innerHTML = `
        <span class="screenplay-title">${screenplay.title}</span>
        <span class="screenplay-count">${screenplay.shots.length} shots</span>
        <span class="collapse-icon">▼</span>
      `;
      
      const strip = document.createElement('div');
      strip.className = 'timeline-strip active';
      
      let globalIndex = state.screenplays.slice(0, spIdx)
        .reduce((sum, sp) => sum + sp.shots.length, 0);
      
      screenplay.shots.forEach((shot, localIdx) => {
        strip.appendChild(createShotCard(shot, globalIndex + localIdx));
      });
      
      header.onclick = () => {
        section.classList.toggle('collapsed');
      };
      
      section.appendChild(header);
      section.appendChild(strip);
      container.appendChild(section);
    });
    
  } else {
    // Grid per screenplay
    state.screenplays.forEach((screenplay, spIdx) => {
      const section = document.createElement('div');
      section.className = 'screenplay-section';
      
      const header = document.createElement('div');
      header.className = 'screenplay-header';
      header.innerHTML = `
        <span class="screenplay-title">${screenplay.title}</span>
        <span class="screenplay-count">${screenplay.shots.length} shots</span>
        <span class="collapse-icon">▼</span>
      `;
      
      const grid = document.createElement('div');
      grid.className = 'shot-grid';
      
      let globalIndex = state.screenplays.slice(0, spIdx)
        .reduce((sum, sp) => sum + sp.shots.length, 0);
      
      screenplay.shots.forEach((shot, localIdx) => {
        grid.appendChild(createShotCard(shot, globalIndex + localIdx));
      });
      
      header.onclick = () => {
        section.classList.toggle('collapsed');
      };
      
      section.appendChild(header);
      section.appendChild(grid);
      container.appendChild(section);
    });
  }
}

// Create shot card
function createShotCard(shot, globalIndex) {
  const card = document.createElement('div');
  card.className = 'shot-card';
  if (globalIndex === state.currentShot) card.classList.add('active');
  
  const thumb = document.createElement('div');
  thumb.className = 'shot-thumb';
  
  const imageUrl = getMediaUrl(shot, 'image');
  const videoUrl = getMediaUrl(shot, 'video');
  
  if (imageUrl) {
    const img = document.createElement('img');
    img.src = imageUrl;
    thumb.appendChild(img);
  }
  
  const num = document.createElement('div');
  num.className = 'shot-number';
  num.textContent = `#${shot.shotNumber}`;
  thumb.appendChild(num);
  
  if (videoUrl) {
    const indicator = document.createElement('div');
    indicator.className = 'video-indicator';
    indicator.textContent = '▶ VIDEO';
    thumb.appendChild(indicator);
  }
  
  const label = document.createElement('div');
  label.className = 'shot-label';
  label.textContent = shot.shotDesc.substring(0, 60) || `Shot ${shot.shotNumber}`;
  label.title = shot.shotDesc;
  
  card.appendChild(thumb);
  card.appendChild(label);
  
  card.onclick = () => {
    showShot(globalIndex);
    if (state.playing) stopPlayback();
  };
  
  return card;
}

// Playback
function startPlayback() {
  if (state.playing) return;
  state.playing = true;
  document.getElementById('play-btn').textContent = '⏸ Pause';
  
  state.playInterval = setInterval(() => {
    if (state.currentShot < state.allShots.length - 1) {
      showShot(state.currentShot + 1);
    } else {
      stopPlayback();
      showShot(0); // Loop back
    }
  }, 3000); // 3 seconds per shot
}

function stopPlayback() {
  state.playing = false;
  document.getElementById('play-btn').textContent = '▶ Play Film';
  if (state.playInterval) {
    clearInterval(state.playInterval);
    state.playInterval = null;
  }
}

// Controls
function setupControls() {
  // Play/Pause
  document.getElementById('play-btn').onclick = () => {
    if (state.playing) {
      stopPlayback();
    } else {
      startPlayback();
    }
  };
  
  // Navigation
  document.getElementById('prev-btn').onclick = () => {
    if (state.currentShot > 0) {
      showShot(state.currentShot - 1);
      if (state.playing) stopPlayback();
    }
  };
  
  document.getElementById('next-btn').onclick = () => {
    if (state.currentShot < state.allShots.length - 1) {
      showShot(state.currentShot + 1);
      if (state.playing) stopPlayback();
    }
  };
  
  // Info toggle
  document.getElementById('toggle-info').onclick = () => {
    state.infoVisible = !state.infoVisible;
    document.getElementById('shot-info').classList.toggle('visible', state.infoVisible);
    document.getElementById('toggle-info').classList.toggle('active', state.infoVisible);
  };
  
  // Style selector
  document.getElementById('style-select').onchange = (e) => {
    state.currentStyle = e.target.value;
    showShot(state.currentShot);
    renderShotWall();
  };
  
  // Wall mode
  document.querySelectorAll('[data-mode]').forEach(btn => {
    btn.onclick = () => {
      state.wallMode = btn.dataset.mode;
      document.querySelectorAll('[data-mode]').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderShotWall();
    };
  });
  
  // Keyboard
  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      document.getElementById('prev-btn').click();
    } else if (e.key === 'ArrowRight') {
      document.getElementById('next-btn').click();
    } else if (e.key === ' ') {
      e.preventDefault();
      document.getElementById('play-btn').click();
    } else if (e.key === 'i') {
      document.getElementById('toggle-info').click();
    }
  });
}

// Start
loadData();
</script>

</body>
</html>
