<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DM MS Student Lifecycle Timeline & Network (2023-2024)</title>
    <!-- Import Vis.js CSS -->
    <link href="https://unpkg.com/vis-network@latest/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />

    <style>
        :root {
            /* -- Base Theme -- */
            --bg-color: #f8f9fa;
            --text-color: #343a40;
            --accent-color: #007bff; /* Primary Blue */
            --secondary-accent-color: #17a2b8; /* Info Cyan */
            --divider-color: #dee2e6;
            --label-bg: rgba(255, 255, 255, 0.9);
            --label-text-color: var(--text-color);
            --today-marker-color: #dc3545; /* Danger Red */
            --focus-outline-color: var(--accent-color);
            --highlight-color: #ffc107; /* Warning Yellow */
            --highlight-border: #e0a800;

            /* -- DM MS Color Coding -- */
            --color-sprout: #28a745; --color-sprout-accent: #218838; /* Success Green */
            --color-fruit: #fd7e14; --color-fruit-accent: #e85a00; /* Orange */
            --color-all: #6f42c1; --color-all-accent: #5a2b9b; /* Indigo */
            --color-milestone: #6c757d; --color-milestone-accent: #5a6268; /* Secondary Gray */
            --color-skill: #17a2b8; --color-skill-accent: #117a8b; /* Info Cyan */
            --color-support: #ffc107; --color-support-accent: #e0a800; /* Warning Yellow */
            --color-idea: #e83e8c; --color-idea-accent: #c2185b; /* Pink */
        }

        /* --- High Contrast Mode --- */
        body.high-contrast {
            --bg-color: #000000;
            --text-color: #FFFFFF;
            --accent-color: #FFFF00;
            --secondary-accent-color: #00FFFF;
            --divider-color: rgba(255, 255, 0, 0.5);
            --label-bg: #000000;
            --label-text-color: #FFFFFF;
            --today-marker-color: #FF00FF;
            --focus-outline-color: #FFFFFF;
            --highlight-color: #FF69B4;
            --highlight-border: #FF1493;

            --color-sprout: #00FF00; --color-sprout-accent: #00FF00;
            --color-fruit: #FFA500; --color-fruit-accent: #FFA500; /* Orange */
            --color-all: #EE82EE; --color-all-accent: #EE82EE; /* Violet */
            --color-milestone: #C0C0C0; --color-milestone-accent: #C0C0C0; /* Silver */
            --color-skill: #00FFFF; --color-skill-accent: #00FFFF;
            --color-support: #FFFF00; --color-support-accent: #FFFF00;
            --color-idea: #FF00FF; --color-idea-accent: #FF00FF;
        }
        /* --- End High Contrast --- */

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0; padding: 0; color: var(--text-color);
            background-color: var(--bg-color); overflow: hidden; /* Prevent body scroll */
            display: flex; flex-direction: column; height: 100vh;
        }

        .header-bar {
             padding: 10px 20px; background-color: #e9ecef;
             border-bottom: 1px solid var(--divider-color);
             display: flex; justify-content: space-between; align-items: center;
        }
        h1 {
            margin: 0; font-size: 1.4rem; color: #333; flex-grow: 1; text-align: center;
        }
        #contrast-toggle { font-size: 0.8rem; padding: 5px 10px; }

        .controls {
            padding: 8px; display: flex; justify-content: center; gap: 8px;
            background-color: #f1f3f5; border-bottom: 1px solid var(--divider-color);
        }
        .controls button, .controls select {
            padding: 5px 10px; border: 1px solid #ced4da; border-radius: 4px;
            background-color: white; font-size: 0.85rem;
        }
         #month-nav { display: contents; } /* Integrate month nav */

        /* Main Layout Panes */
        .main-container {
            display: flex; flex: 1; /* Take remaining height */
            overflow: hidden; /* Prevent overflow */
            position: relative; /* For absolute positioned children like resizer */
        }

        .left-panel {
            flex: 3; /* Takes more space initially */
            display: flex; flex-direction: column;
            overflow: hidden; position: relative;
        }

        .right-panel { /* Details Panel */
            flex: 1; /* Takes less space initially */
            min-width: 250px; max-width: 40%; /* Constraints */
            border-left: 1px solid var(--divider-color);
            display: flex; flex-direction: column;
            overflow: hidden; position: relative;
        }

        /* Vertical Resize Handle */
        .resize-handle-vertical {
            width: 10px; cursor: ew-resize; background-color: #e9ecef;
            border-left: 1px solid var(--divider-color); border-right: 1px solid var(--divider-color);
            position: absolute; top: 0; bottom: 0; left: -5px; /* Center handle */
            z-index: 10; display: flex; align-items: center; justify-content: center;
        }
        .resize-handle-vertical::after { content: "⋮"; color: #6c757d; font-size: 16px; }

        /* Timeline Container */
        #timeline-container {
            height: 250px; /* Initial height */
            min-height: 100px; max-height: 60%; /* Constraints */
            border-bottom: 1px solid var(--divider-color);
            position: relative; overflow: hidden;
        }
         /* Horizontal Resize Handle */
        .resize-handle-horizontal {
            height: 10px; background-color: #e9ecef; cursor: ns-resize;
            border-top: 1px solid var(--divider-color); border-bottom: 1px solid var(--divider-color);
            position: absolute; bottom: -5px; left: 0; right: 0; z-index: 10;
            display: flex; align-items: center; justify-content: center;
        }
        .resize-handle-horizontal::after { content: "…"; color: #6c757d; font-size: 16px; letter-spacing: 2px; }


        #timeline { width: 100%; height: 100%; }

        /* Network Container */
        #network-container {
            flex: 1; /* Takes remaining space in left panel */
            position: relative; overflow: hidden;
            border-bottom: none; /* No bottom border if it's the last element */
        }
        #network {
            width: 100%; height: 100%;
            background-color: white; border: 1px solid transparent; /* Border handled by container */
        }

         /* Details Panel Container */
        #details-container {
            flex: 1; display: flex; flex-direction: column; overflow: hidden;
        }
        .section-header {
            padding: 8px 12px; background-color: #e9ecef;
            border-bottom: 1px solid var(--divider-color); font-weight: 600;
            font-size: 0.9rem; color: #495057;
        }
        #details-content {
            padding: 15px; overflow-y: auto; flex: 1;
            font-size: 0.9rem; line-height: 1.5;
        }
         #details-content h4 { margin: 15px 0 5px 0; font-size: 1rem; color: var(--accent-color); border-bottom: 1px solid var(--divider-color); padding-bottom: 3px;}
         #details-content p { margin-bottom: 10px; }
         #details-content strong { font-weight: 600; color: var(--secondary-accent-color); }
         #details-content ul { padding-left: 20px; margin-top: 5px; }
         #details-content li { margin-bottom: 4px; }
         .details-meta { font-size: 0.8rem; color: #6c757d; margin-top: 10px; }
         .details-meta span { margin-right: 15px; }


        /* Vis.js Customizations */
        .vis-timeline { border: none; }
        .vis-item { font-size: 0.75rem; padding: 4px 6px; border-radius: 4px; }

        /* Timeline Group Styles */
        .vis-left .vis-group.sprout { border-left: 3px solid var(--color-sprout); }
        .vis-left .vis-group.fruit { border-left: 3px solid var(--color-fruit); }
        .vis-left .vis-group.all { border-left: 3px solid var(--color-all); }
        .vis-left .vis-group.milestone { border-left: 3px solid var(--color-milestone); }

        /* Timeline Item Styles (using classNames) */
        .vis-item.deliverable-fall { background-color: var(--color-sprout); border-color: var(--color-sprout-accent); color: white; }
        .vis-item.deliverable-spring { background-color: var(--color-fruit); border-color: var(--color-fruit-accent); color: white; }
        .vis-item.meeting-workshop { background-color: var(--color-all); border-color: var(--color-all-accent); color: white; }
        .vis-item.milestone { background-color: var(--color-milestone); border-color: var(--color-milestone-accent); color: white; }
        .vis-item.idea { background-color: var(--color-idea); border-color: var(--color-idea-accent); color: white; opacity: 0.8; }

        /* Highlight Styles */
        .highlighted-node { /* Applied via JS to node's options, simpler this way */ }
        .highlighted-edge { /* Applied via JS */ }
        .vis-item.highlighted-item {
            background-color: var(--highlight-color) !important;
            border-color: var(--highlight-border) !important;
            box-shadow: 0 0 8px var(--highlight-color);
            color: #333 !important; /* Ensure text is readable */
            z-index: 10 !important;
        }

        /* Today Marker */
         #today-marker-timeline {
             position: absolute; top: 0; bottom: 0;
             width: 2px; background-color: var(--today-marker-color);
             z-index: 5; pointer-events: none; opacity: 0.7;
         }
          #today-marker-timeline::after { /* Label */
            content: 'TODAY'; position: absolute; top: 5px; left: 4px;
            background: var(--today-marker-color); color: white; padding: 1px 4px;
            font-size: 0.6em; border-radius: 3px; font-weight: bold;
         }

        /* Tooltip styling - Using Vis.js built-in but styled */
        div.vis-tooltip {
            font-family: system-ui, -apple-system, sans-serif !important;
            padding: 8px 10px !important;
            background-color: var(--label-bg) !important;
            border: 1px solid var(--divider-color) !important;
            color: var(--label-text-color) !important;
            border-radius: 4px !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important;
            font-size: 0.8rem !important;
            max-width: 350px !important;
            white-space: normal !important; /* Allow wrapping */
            z-index: 10000 !important;
        }
         body.high-contrast div.vis-tooltip {
              border-color: var(--accent-color) !important;
         }

    </style>
</head>
<body>
    <div class="header-bar">
        <h1>DM MS Student Lifecycle (Fall 2023 – Spring 2024)</h1>
        <button id="contrast-toggle" title="Toggle High Contrast Mode">Contrast</button>
    </div>

    <div class="controls">
        <button id="zoomIn" title="Zoom Network In">+</button>
        <button id="zoomOut" title="Zoom Network Out">−</button>
        <button id="resetView" title="Reset Network View">Reset View</button>
        <select id="filterSelect" title="Filter by Category">
            <option value="all">All Categories</option>
            <option value="sprout">🌱 Sprouts (1st Yr)</option>
            <option value="fruit">🍓 Fruits (2nd Yr)</option>
            <option value="allStudents">👥 All Students</option>
            <option value="milestone">⏱️ Milestones</option>
            <option value="deliverable">📝 Deliverables</option>
             <option value="support">🤝 Support</option>
        </select>
        <div id="month-nav" aria-label="Jump to Month Navigation">
           <!-- Buttons added by JS -->
        </div>
        <button id="hide-details" title="Toggle Details Panel">Hide Details ▶</button>
    </div>

    <div class="main-container">
        <!-- Left Panel (Timeline + Network) -->
        <div class="left-panel">
            <div id="timeline-container" role="region" aria-labelledby="timeline-heading">
                 <div id="today-marker-timeline" aria-hidden="true"></div>
                 <div id="timeline"></div>
                 <div class="resize-handle-horizontal" id="timeline-resize-handle"></div>
            </div>
            <div id="network-container" role="region" aria-labelledby="network-heading">
                 <div id="network"></div>
            </div>
        </div>

        <!-- Vertical Resizer -->
        <div class="resize-handle-vertical" id="panel-resize-handle"></div>

        <!-- Right Panel (Details) -->
        <div class="right-panel" id="details-panel">
            <div id="details-container">
                <div class="section-header" id="details-heading">Details</div>
                <div id="details-content" role="region" aria-live="polite">
                    <p>Click on an item in the timeline or a node in the network to see details here.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Vis.js Libraries -->
    <script type="text/javascript" src="https://unpkg.com/vis-network@latest/standalone/umd/vis-network.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuration ---
            const config = {
                timelineStart: '2023-08-15',
                timelineEnd: '2024-05-15',
                groups: {
                    SPROUT: 'sprout',
                    FRUIT: 'fruit',
                    ALL: 'all',
                    MILESTONE: 'milestone',
                    DELIVERABLE_FALL: 'deliverableFall',
                    DELIVERABLE_SPRING: 'deliverableSpring',
                    MEETING: 'meetingWorkshop',
                    IDEA: 'idea',
                    SKILL: 'skill',
                    SUPPORT: 'support',
                    SEMESTER: 'semester',
                    STUDENT_TYPE: 'studentType'
                },
                timelineItemClasses: {
                    DELIVERABLE_FALL: 'deliverable-fall',
                    DELIVERABLE_SPRING: 'deliverable-spring',
                    MEETING: 'meeting-workshop',
                    MILESTONE: 'milestone',
                    IDEA: 'idea',
                }
            };

            // --- DATA ---
             const nodes = new vis.DataSet([
                // Student Types
                { id: 'sprout', label: '🌱\nSprout\n(1st Yr)', group: config.groups.STUDENT_TYPE, details: '<h4>🌱 Sprout (1st Year)</h4><p>Focuses on foundational work, defining research questions, literature review, and initial prototyping concepts.</p>', mass: 3 },
                { id: 'fruit', label: '🍓\nFruit\n(2nd Yr)', group: config.groups.STUDENT_TYPE, details: '<h4>🍓 Fruit (2nd Year)</h4><p>Focuses on project execution, prototyping, testing/evaluation, final documentation, and presentation.</p>', mass: 3 },

                // Semesters
                { id: 'fall-y1', label: 'Fall Y1\n(Aug-Dec \'23)', group: config.groups.SEMESTER, details: '<h4>Fall Semester - Year 1</h4><p>Primary focus for Sprouts. Establish project direction.</p>' },
                { id: 'spring-y1', label: 'Spring Y1\n(Jan-May \'24)', group: config.groups.SEMESTER, details: '<h4>Spring Semester - Year 1</h4><p>Continuation for Sprouts, potential early work for Fruits if starting early.</p>' },
                // Add Y2 if needed for longer view, but current data is only Y1/Y2 transition
                // { id: 'fall-y2', label: 'Fall Y2', group: config.groups.SEMESTER },
                // { id: 'spring-y2', label: 'Spring Y2', group: config.groups.SEMESTER },

                // Fall Deliverables (Linked to timeline items)
                { id: 'f23-rq', label: 'RQ Set', group: config.groups.DELIVERABLE_FALL, timelineId: 'tl-f23-rq', details: '<h4>🌱 Research Question Set (Fall)</h4><p><strong>Due:</strong> Sep 21/26, 2023<br><strong>Points:</strong> 15</p><p>Initial project review (related work), literature themes, 5-min presentation, draft schedule. Graduating students give longer progress report.</p><strong>Requires:</strong> Initial Ideas, Advisor Input' },
                { id: 'f23-lit', label: 'Lit Review v2', group: config.groups.DELIVERABLE_FALL, timelineId: 'tl-f23-lit', details: '<h4>🌱 Literature Review v2 (Fall)</h4><p><strong>Due:</strong> ~Oct 12, 2023<br><strong>Points:</strong> 15</p><p>Detailed written literature review (structured essay, key takeaways, tech review).</p><strong>Requires:</strong> RQ Set, Research Skills' },
                { id: 'f23-web', label: 'Web Page & Plan', group: config.groups.DELIVERABLE_FALL, timelineId: 'tl-f23-web', details: '<h4>🌱 Web Page & Revised Plan (Fall)</h4><p><strong>Due:</strong> Nov 1, 2023<br><strong>Points:</strong> 30</p><p>Project web page live. Revised RQs/Research Plan. Design criteria brainstorm. Methodology consideration. IRB submission if needed.</p><strong>Requires:</strong> Lit Review v2, Web Dev Skills' },
                { id: 'f23-outline', label: 'Outline/Proto Criteria', group: config.groups.DELIVERABLE_FALL, timelineId: 'tl-f23-outline', details: '<h4>🌱 Outline / Prototype Design Criteria (Fall)</h4><p><strong>Due:</strong> Nov 29, 2023<br><strong>Points:</strong> 30</p><p>Proposal presentation. Tech feasibility demo. Lit review summary, RQs, design criteria, research plan. Documented sketches/brainstorming.</p><strong>Requires:</strong> Web Page & Plan, Prototyping Ideas' },
                { id: 'f23-part', label: 'Fall Participation', group: config.groups.DELIVERABLE_FALL, timelineId: 'tl-f23-part', details: '<h4>🌱 Overall Participation (Fall)</h4><p><strong>Due:</strong> ~Dec 10, 2023<br><strong>Points:</strong> 10</p><p>Assessed participation & constructive peer feedback throughout Fall semester.</p>' },

                 // Spring Deliverables (Linked to timeline items)
                { id: 's24-draft', label: 'Draft / Proto', group: config.groups.DELIVERABLE_SPRING, timelineId: 'tl-s24-draft', details: '<h4>🍓 First Draft / Prototype (Spring)</h4><p><strong>Due:</strong> ~Mar 1, 2024</p><p>First complete draft (thesis) or functional prototype (project).</p><strong>Requires:</strong> Outline/Criteria, Prototyping Skills' },
                { id: 's24-revised', label: 'Revised / Testing', group: config.groups.DELIVERABLE_SPRING, timelineId: 'tl-s24-revised', details: '<h4>🍓 Revised Draft / Testing Results (Spring)</h4><p><strong>Due:</strong> ~Mar 15, 2024</p><p>Iterated prototype/draft. User testing results/findings OR written reflection/heuristic eval.</p><strong>Requires:</strong> Draft/Proto, User Testing Skills / Reflection' },
                { id: 's24-final-del', label: 'Final Deliverable', group: config.groups.DELIVERABLE_SPRING, timelineId: 'tl-s24-final-del', details: '<h4>🍓 Deliverable Done (Spring)</h4><p><strong>Due:</strong> ~Apr 1, 2024</p><p>Final iterated prototype/draft. Rough but submittable final materials (design docs, slides, thesis draft). Test presentation practice.</p><strong>Requires:</strong> Revised/Testing, Documentation Skills' },
                { id: 's24-video', label: 'Video', group: config.groups.DELIVERABLE_SPRING, timelineId: 'tl-s24-video', details: '<h4>🍓 Video Done (Spring)</h4><p><strong>Due:</strong> ~Apr 7, 2024</p><p>Project video completed.</p><strong>Requires:</strong> Final Deliverable, Video Editing Skills' },

                // Milestones (Linked)
                { id: 'm-fall-grades', label: 'Fall Grades', group: config.groups.MILESTONE, timelineId: 'tl-m-fall-grades', details: '<h4>⏱️ Fall Grades Due</h4><p><strong>Date:</strong> ~Dec 15, 2023</p><p>Approximate deadline for Fall P/F grades.</p>' },
                { id: 'm-pres', label: 'Final Presentations', group: config.groups.MILESTONE, timelineId: 'tl-m-pres', details: '<h4>⏱️ Final Presentations</h4><p><strong>Date:</strong> ~Apr 15, 2024</p><p>Department-wide final project/thesis presentations.</p>' },
                { id: 'm-submit', label: 'Final Submission', group: config.groups.MILESTONE, timelineId: 'tl-m-submit', details: '<h4>⏱️ Final Submission</h4><p><strong>Date:</strong> ~May 1, 2024</p><p>Final project materials submitted (website, video, docs, thesis).</p>' },
                { id: 'm-spring-grades', label: 'Spring Grades', group: config.groups.MILESTONE, timelineId: 'tl-m-spring-grades', details: '<h4>⏱️ Spring Grades Due</h4><p><strong>Date:</strong> ~May 8, 2024</p><p>Approximate deadline for Spring letter grades.</p>' },

                // Support Structures
                { id: 'advisors', label: 'Faculty\nAdvisors', group: config.groups.SUPPORT, details: '<h4>🤝 Faculty Advisors</h4><p>Richmond Wong, Anne Sullivan, Noura Howell, Michael Nitsche. Provide guidance, feedback, and evaluation. Regular meetings supplement the course structure.</p>' },
                { id: 'peer-feedback', label: 'Peer\nFeedback', group: config.groups.SUPPORT, details: '<h4>🤝 Peer Feedback</h4><p>Essential part of the course. Give and receive constructive feedback during presentations and meetings. Contributes to participation grade.</p>' },
                { id: 'running-notes', label: 'Running\nNotes Doc', group: config.groups.SUPPORT, details: '<h4>🤝 Running Notes Document</h4><p>Per-student document on OneDrive for tracking meetings, feedback, progress, goals, etc. Maintained collaboratively.</p>' },
                { id: 'meetings', label: 'Course\nMeetings', group: config.groups.MEETING, timelineId: 'tl-meetings', details: '<h4>👥 Course Meetings</h4><p>Alternating weeks: Tuesdays (5-6:30pm) & Thursdays (2-3:30pm). Check invites. Includes presentations, workshops, discussions.</p>' },

                 // Skills (Examples)
                { id: 'skill-research', label: 'Research\nMethods', group: config.groups.SKILL, details: '<h4>🛠️ Research Methods</h4><p>Literature review, defining research questions, understanding related work, potential user studies.</p>' },
                { id: 'skill-writing', label: 'Academic\nWriting', group: config.groups.SKILL, details: '<h4>🛠️ Academic Writing</h4><p>Structuring reviews, proposals, final documentation/thesis.</p>' },
                { id: 'skill-web', label: 'Web Dev', group: config.groups.SKILL, details: '<h4>🛠️ Web Development</h4><p>Creating project websites on GT servers.</p>' },
                { id: 'skill-proto', label: 'Prototyping', group: config.groups.SKILL, details: '<h4>🛠️ Prototyping</h4><p>Sketching, brainstorming, demonstrating technical feasibility, building interactive prototypes.</p>' },
                { id: 'skill-eval', label: 'Evaluation\n/ Testing', group: config.groups.SKILL, details: '<h4>🛠️ Evaluation / Testing</h4><p>User testing, heuristic evaluation, reflection on design.</p>' },
                { id: 'skill-pres', label: 'Presentation', group: config.groups.SKILL, details: '<h4>🛠️ Presentation Skills</h4><p>Presenting work clearly and concisely to peers and faculty.</p>' },
                 { id: 'skill-video', label: 'Video Prod.', group: config.groups.SKILL, details: '<h4>🛠️ Video Production</h4><p>Creating a summary video of the project.</p>' },

                  // Ideas (Examples, link to timeline)
                 { id: 'idea-slack', label: 'Slack?', group: config.groups.IDEA, timelineId: 'tl-idea-slack', details: '<h4>💡 Idea: Move to Slack?</h4><p>Discuss potential move from Teams to Slack for better community building. Involves DM Club/Reps.</p>' },
                 { id: 'idea-hackathon', label: 'Hackathon?', group: config.groups.IDEA, timelineId: 'tl-idea-hackathon', details: '<h4>💡 Idea: DM Hackathon</h4><p>Explore organizing a Digital Media focused hackathon.</p>' },
                 { id: 'idea-buddy', label: 'Alumni Buddy?', group: config.groups.IDEA, timelineId: 'tl-idea-buddy', details: '<h4>💡 Idea: Alumni Buddy System</h4><p>Potential system for one-off professional contact sessions with alumni.</p>' },
            ]);

            const edges = new vis.DataSet([
                // Progression
                { from: 'sprout', to: 'fruit', label: 'becomes', arrows: 'to', length: 250 },
                { from: 'sprout', to: 'fall-y1', label: 'active in', arrows: 'to' },
                { from: 'sprout', to: 'spring-y1', label: 'active in', arrows: 'to' },
                 // Fruit might start some Spring Y1 work or focus entirely on Y2 (represented by spring deliverables)
                 { from: 'fruit', to: 'spring-y1', label: 'overlaps', arrows: 'to', dashes: true }, // Indicate overlap

                // Semester contains Deliverables/Milestones
                { from: 'fall-y1', to: 'f23-rq', label: 'contains', arrows: 'to' },
                { from: 'fall-y1', to: 'f23-lit', label: 'contains', arrows: 'to' },
                { from: 'fall-y1', to: 'f23-web', label: 'contains', arrows: 'to' },
                { from: 'fall-y1', to: 'f23-outline', label: 'contains', arrows: 'to' },
                { from: 'fall-y1', to: 'f23-part', label: 'contains', arrows: 'to' },
                { from: 'fall-y1', to: 'm-fall-grades', label: 'ends with', arrows: 'to' },

                { from: 'spring-y1', to: 's24-draft', label: 'contains', arrows: 'to' },
                { from: 'spring-y1', to: 's24-revised', label: 'contains', arrows: 'to' },
                { from: 'spring-y1', to: 's24-final-del', label: 'contains', arrows: 'to' },
                { from: 'spring-y1', to: 's24-video', label: 'contains', arrows: 'to' },
                { from: 'spring-y1', to: 'm-pres', label: 'contains', arrows: 'to' },
                { from: 'spring-y1', to: 'm-submit', label: 'ends with', arrows: 'to' },
                { from: 'spring-y1', to: 'm-spring-grades', label: 'ends with', arrows: 'to' },

                // Deliverable Dependencies / Skill Links
                { from: 'f23-lit', to: 'f23-rq', label: 'builds on', arrows: 'to', dashes: true },
                { from: 'f23-web', to: 'f23-lit', label: 'requires', arrows: 'to', dashes: true },
                { from: 'f23-outline', to: 'f23-web', label: 'builds on', arrows: 'to', dashes: true },
                { from: 's24-draft', to: 'f23-outline', label: 'implements', arrows: 'to', dashes: true },
                { from: 's24-revised', to: 's24-draft', label: 'iterates', arrows: 'to', dashes: true },
                 { from: 's24-final-del', to: 's24-revised', label: 'refines', arrows: 'to', dashes: true },
                 { from: 's24-video', to: 's24-final-del', label: 'documents', arrows: 'to', dashes: true },
                 { from: 'm-submit', to: 's24-final-del', label: 'includes', arrows: 'to', dashes: true },
                 { from: 'm-submit', to: 's24-video', label: 'includes', arrows: 'to', dashes: true },


                { from: 'f23-rq', to: 'skill-research', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 'f23-rq', to: 'skill-pres', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 'f23-lit', to: 'skill-research', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 'f23-lit', to: 'skill-writing', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 'f23-web', to: 'skill-web', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                 { from: 'f23-web', to: 'skill-writing', label: 'develops', arrows: 'to', color: { opacity: 0.5 } }, // Research plan
                { from: 'f23-outline', to: 'skill-proto', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 'f23-outline', to: 'skill-pres', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                 { from: 's24-draft', to: 'skill-proto', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 's24-revised', to: 'skill-eval', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 's24-final-del', to: 'skill-writing', label: 'develops', arrows: 'to', color: { opacity: 0.5 } }, // Docs
                { from: 's24-video', to: 'skill-video', label: 'develops', arrows: 'to', color: { opacity: 0.5 } },
                { from: 'm-pres', to: 'skill-pres', label: 'assesses', arrows: 'to', color: { opacity: 0.5 } },


                // Support Links
                 { from: 'sprout', to: 'advisors', label: 'supported by', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'fruit', to: 'advisors', label: 'supported by', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'sprout', to: 'peer-feedback', label: 'supported by', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'fruit', to: 'peer-feedback', label: 'supported by', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'sprout', to: 'running-notes', label: 'uses', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'fruit', to: 'running-notes', label: 'uses', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'sprout', to: 'meetings', label: 'attends', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'fruit', to: 'meetings', label: 'attends', arrows: 'to', dashes: true, color: { opacity: 0.6 } },
                 { from: 'advisors', to: 'running-notes', label: 'contributes to', arrows: 'to', dashes: true, color: { opacity: 0.6 } },

                 // Ideas linked to student types/support
                 { from: 'idea-slack', to: 'sprout', label: 'benefits', arrows: 'to', dashes: true, color: { opacity: 0.4 } },
                 { from: 'idea-slack', to: 'fruit', label: 'benefits', arrows: 'to', dashes: true, color: { opacity: 0.4 } },
                 { from: 'idea-hackathon', to: 'sprout', label: 'event for', arrows: 'to', dashes: true, color: { opacity: 0.4 } },
                 { from: 'idea-hackathon', to: 'fruit', label: 'event for', arrows: 'to', dashes: true, color: { opacity: 0.4 } },
                 { from: 'idea-buddy', to: 'fruit', label: 'support for', arrows: 'to', dashes: true, color: { opacity: 0.4 } }, // More relevant for Fruits?

            ]);

            const timelineItems = new vis.DataSet([
                 // Fall 2023
                { id: 'tl-f23-rq', content: '🌱 RQ Set', start: '2023-09-21', group: config.groups.SPROUT, className: config.timelineItemClasses.DELIVERABLE_FALL, nodeId: 'f23-rq', details: nodes.get('f23-rq').details },
                { id: 'tl-f23-lit', content: '🌱 Lit Review v2', start: '2023-10-12', group: config.groups.SPROUT, className: config.timelineItemClasses.DELIVERABLE_FALL, nodeId: 'f23-lit', details: nodes.get('f23-lit').details },
                { id: 'tl-f23-web', content: '🌱 Web Page & Plan', start: '2023-11-01', group: config.groups.SPROUT, className: config.timelineItemClasses.DELIVERABLE_FALL, nodeId: 'f23-web', details: nodes.get('f23-web').details },
                { id: 'tl-f23-outline', content: '🌱 Outline/Proto', start: '2023-11-29', group: config.groups.SPROUT, className: config.timelineItemClasses.DELIVERABLE_FALL, nodeId: 'f23-outline', details: nodes.get('f23-outline').details },
                { id: 'tl-f23-part', content: '🌱 Fall Participation', start: '2023-12-10', group: config.groups.SPROUT, className: config.timelineItemClasses.DELIVERABLE_FALL, nodeId: 'f23-part', details: nodes.get('f23-part').details },
                { id: 'tl-m-fall-grades', content: '⏱️ Fall Grades', start: '2023-12-15', group: config.groups.MILESTONE, className: config.timelineItemClasses.MILESTONE, nodeId: 'm-fall-grades', details: nodes.get('m-fall-grades').details },

                 // Spring 2024
                { id: 'tl-s24-draft', content: '🍓 Draft/Proto', start: '2024-03-01', group: config.groups.FRUIT, className: config.timelineItemClasses.DELIVERABLE_SPRING, nodeId: 's24-draft', details: nodes.get('s24-draft').details },
                { id: 'tl-s24-revised', content: '🍓 Revised/Testing', start: '2024-03-15', group: config.groups.FRUIT, className: config.timelineItemClasses.DELIVERABLE_SPRING, nodeId: 's24-revised', details: nodes.get('s24-revised').details },
                { id: 'tl-s24-final-del', content: '🍓 Final Deliverable', start: '2024-04-01', group: config.groups.FRUIT, className: config.timelineItemClasses.DELIVERABLE_SPRING, nodeId: 's24-final-del', details: nodes.get('s24-final-del').details },
                { id: 'tl-s24-video', content: '🍓 Video Done', start: '2024-04-07', group: config.groups.FRUIT, className: config.timelineItemClasses.DELIVERABLE_SPRING, nodeId: 's24-video', details: nodes.get('s24-video').details },
                { id: 'tl-m-pres', content: '⏱️ Final Pres.', start: '2024-04-15', group: config.groups.MILESTONE, className: config.timelineItemClasses.MILESTONE, nodeId: 'm-pres', details: nodes.get('m-pres').details },
                { id: 'tl-m-submit', content: '⏱️ Final Submit', start: '2024-05-01', group: config.groups.MILESTONE, className: config.timelineItemClasses.MILESTONE, nodeId: 'm-submit', details: nodes.get('m-submit').details },
                { id: 'tl-m-spring-grades', content: '⏱️ Spring Grades', start: '2024-05-08', group: config.groups.MILESTONE, className: config.timelineItemClasses.MILESTONE, nodeId: 'm-spring-grades', details: nodes.get('m-spring-grades').details },

                 // Meetings (Recurring - simplified as a single point for now, could be background)
                 { id: 'tl-meetings', content: '👥 Meetings', start: '2023-09-05', group: config.groups.ALL, className: config.timelineItemClasses.MEETING, nodeId: 'meetings', details: nodes.get('meetings').details },

                 // Ideas (placed roughly)
                 { id: 'tl-idea-slack', content: '💡 Discuss Slack?', start: '2023-09-15', group: config.groups.ALL, className: config.timelineItemClasses.IDEA, nodeId: 'idea-slack', details: nodes.get('idea-slack').details },
                 { id: 'tl-idea-hackathon', content: '💡 Hackathon?', start: '2024-01-20', group: config.groups.ALL, className: config.timelineItemClasses.IDEA, nodeId: 'idea-hackathon', details: nodes.get('idea-hackathon').details },
                 { id: 'tl-idea-buddy', content: '💡 Alumni Buddy?', start: '2023-11-05', group: config.groups.ALL, className: config.timelineItemClasses.IDEA, nodeId: 'idea-buddy', details: nodes.get('idea-buddy').details },
            ]);

            const timelineGroups = new vis.DataSet([
                { id: config.groups.SPROUT, content: '🌱 Sprouts (1st Yr)'},
                { id: config.groups.FRUIT, content: '🍓 Fruits (2nd Yr)'},
                { id: config.groups.ALL, content: '👥 All / Course Activity'},
                { id: config.groups.MILESTONE, content: '⏱️ Milestones / Deadlines'},
            ]);

            // --- DOM References ---
            const timelineContainer = document.getElementById('timeline');
            const networkContainer = document.getElementById('network');
            const detailsContentEl = document.getElementById('details-content');
            const filterSelect = document.getElementById('filterSelect');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const resetViewBtn = document.getElementById('resetView');
            const hideDetailsBtn = document.getElementById('hide-details');
            const detailsPanel = document.getElementById('details-panel');
            const leftPanel = document.querySelector('.left-panel');
            const panelResizeHandle = document.getElementById('panel-resize-handle');
            const timelineResizeHandle = document.getElementById('timeline-resize-handle');
            const timelineVisContainer = document.getElementById('timeline-container'); // The visual container
            const networkVisContainer = document.getElementById('network-container');
            const todayMarkerTimelineEl = document.getElementById('today-marker-timeline');
            const contrastToggleBtn = document.getElementById('contrast-toggle');
             const monthNavContainer = document.getElementById('month-nav');


            // --- Vis.js Instances ---
            let timeline = null;
            let network = null;

            // --- State ---
            let lastSelectedNodeId = null;
            let lastSelectedItemId = null;

            // --- Initialization ---
            function initializeVisualizations() {
                initializeTimeline();
                initializeNetwork();
                renderTodayMarker();
                setupEventListeners();
                 renderMonthNav();
                initializeResizers();
                populateDetailsPanel('<p>Select an item or node to begin.</p>'); // Initial message
            }

            function initializeTimeline() {
                const timelineOptions = {
                    stack: false, // Avoid stacking to see overlaps clearly
                    verticalScroll: false, // Keep it simple
                    zoomKey: 'ctrlKey',
                    zoomMin: 1000 * 60 * 60 * 24 * 7, // 1 week min zoom
                    zoomMax: 1000 * 60 * 60 * 24 * 365 * 2, // 2 years max zoom
                    height: '100%',
                    showCurrentTime: false, // Using custom marker
                    margin: { item: { vertical: 5 }, axis: 10 },
                    orientation: { axis: "bottom" },
                    groupOrder: (a, b) => { // Custom sort order
                        const order = [config.groups.MILESTONE, config.groups.ALL, config.groups.SPROUT, config.groups.FRUIT];
                        return order.indexOf(a.id) - order.indexOf(b.id);
                    },
                    tooltip: {
                        followMouse: true,
                        overflowMethod: 'flip'
                    },
                    editable: false // Prevent dragging items
                };
                try {
                     timeline = new vis.Timeline(timelineContainer, timelineItems, timelineGroups, timelineOptions);
                     timeline.setWindow(config.timelineStart, config.timelineEnd);
                     timeline.on('select', handleTimelineSelect);
                     timeline.on('click', (props) => { // Handle clicks on empty space
                         if (!props.item && !props.group) {
                             clearHighlights();
                             populateDetailsPanel('<p>Select an item or node.</p>');
                         }
                     });
                     console.log("Timeline Initialized");
                } catch(e) { console.error("Timeline Init Error:", e); timelineContainer.innerHTML = "Error loading timeline."; }
            }

            function initializeNetwork() {
                const networkOptions = {
                     nodes: {
                         shape: 'dot', size: 18,
                         font: { size: 10, color: '#555', face: 'system-ui, sans-serif', multi: 'html', align: 'center' },
                         borderWidth: 2,
                         shadow: { enabled: true, size: 5, x: 2, y: 2, color: 'rgba(0,0,0,0.1)'}
                     },
                     edges: {
                         width: 1.5,
                         font: { size: 9, align: 'middle', color: '#666', strokeWidth: 2, strokeColor: 'rgba(255,255,255,0.7)' },
                         arrows: { to: { enabled: true, scaleFactor: 0.7 } },
                         color: { inherit: 'from', opacity: 0.7 },
                         smooth: { type: 'cubicBezier', forceDirection: 'horizontal', roundness: 0.4 }
                     },
                     physics: {
                         enabled: true,
                         solver: 'forceAtlas2Based',
                         forceAtlas2Based: { gravitationalConstant: -40, centralGravity: 0.005, springLength: 120, springConstant: 0.05, damping: 0.5, avoidOverlap: 0.8 },
                         stabilization: { iterations: 1000, fit: true }
                     },
                     interaction: {
                         hover: true, tooltipDelay: 250, dragNodes: true, dragView: true, zoomView: true,
                         navigationButtons: false // Using custom buttons
                     },
                     groups: { // Define node styles per group
                         [config.groups.STUDENT_TYPE]: { color: { background: '#e9ecef', border: '#adb5bd' }, shape: 'ellipse', font: { size: 14, bold: true }, mass: 3 },
                         [config.groups.SEMESTER]: { color: { background: '#cfe2ff', border: '#9ec5fe' }, shape: 'box', mass: 1.5 },
                         [config.groups.DELIVERABLE_FALL]: { color: { background: 'var(--color-sprout)', border: 'var(--color-sprout-accent)' }, font: { color: 'white' } },
                         [config.groups.DELIVERABLE_SPRING]: { color: { background: 'var(--color-fruit)', border: 'var(--color-fruit-accent)' }, font: { color: 'white' } },
                         [config.groups.MILESTONE]: { color: { background: 'var(--color-milestone)', border: 'var(--color-milestone-accent)' }, font: { color: 'white' }, shape: 'diamond' },
                         [config.groups.MEETING]: { color: { background: 'var(--color-all)', border: 'var(--color-all-accent)' }, font: { color: 'white' } },
                         [config.groups.IDEA]: { color: { background: 'var(--color-idea)', border: 'var(--color-idea-accent)' }, font: { color: 'white' }, shape: 'star', opacity: 0.8 },
                         [config.groups.SKILL]: { color: { background: 'var(--color-skill)', border: 'var(--color-skill-accent)' }, font: { color: 'white' }, shape: 'hexagon' },
                         [config.groups.SUPPORT]: { color: { background: 'var(--color-support)', border: 'var(--color-support-accent)' }, font: { color: '#333'}, shape: 'triangle' }
                     }
                 };
                 try {
                     network = new vis.Network(networkContainer, { nodes, edges }, networkOptions);
                     network.on('selectNode', handleNetworkSelect);
                     network.on('deselectNode', handleNetworkDeselect);
                      network.on('click', (props) => { // Handle clicks on empty space
                         if (props.nodes.length === 0 && props.edges.length === 0) {
                             clearHighlights();
                             populateDetailsPanel('<p>Select an item or node.</p>');
                         }
                     });
                     console.log("Network Initialized");
                 } catch(e) { console.error("Network Init Error:", e); networkContainer.innerHTML = "Error loading network."; }
            }

             function renderMonthNav() {
                 monthNavContainer.innerHTML = ''; // Clear existing
                 const months = ['Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar', 'Apr', 'May'];
                 const yearMap = { Sep: 2023, Oct: 2023, Nov: 2023, Dec: 2023, Jan: 2024, Feb: 2024, Mar: 2024, Apr: 2024, May: 2024};
                 months.forEach(month => {
                     const button = document.createElement('button');
                     button.textContent = `${month} '${String(yearMap[month]).slice(2)}`;
                     button.dataset.month = month;
                     button.dataset.year = yearMap[month];
                     button.setAttribute('aria-label', `Jump to ${month} ${yearMap[month]}`);
                     monthNavContainer.appendChild(button);
                 });
             }

            function renderTodayMarker() {
                 const start = new Date(config.timelineStart);
                 const end = new Date(config.timelineEnd);
                 const today = new Date();

                 if (today >= start && today <= end && timeline) {
                     const percentage = (today.getTime() - start.getTime()) / (end.getTime() - start.getTime()) * 100;
                     if (percentage >= 0 && percentage <= 100) {
                         todayMarkerTimelineEl.style.left = `${percentage}%`;
                         todayMarkerTimelineEl.style.display = 'block';
                     } else {
                          todayMarkerTimelineEl.style.display = 'none';
                     }
                 } else {
                      todayMarkerTimelineEl.style.display = 'none';
                 }
            }


            // --- Event Handlers ---
            function handleTimelineSelect(properties) {
                const ids = properties.items;
                if (ids.length > 0) {
                    const selectedId = ids[0];
                    const item = timelineItems.get(selectedId);
                    clearHighlights(); // Clear previous before applying new
                    if (item) {
                        populateDetailsPanel(item.details || '<p>No details available.</p>');
                        highlightTimelineItem(selectedId);
                        if (item.nodeId && nodes.get(item.nodeId)) {
                             highlightNetworkNode(item.nodeId);
                             // Optionally fit network to the highlighted node
                              network.focus(item.nodeId, { scale: 1.2, animation: true });
                        }
                        lastSelectedItemId = selectedId;
                        lastSelectedNodeId = item.nodeId || null;
                    }
                }
                 // Don't clear on deselect from timeline click, wait for empty space click
            }

            function handleNetworkSelect(params) {
                const ids = params.nodes;
                 if (ids.length > 0) {
                    const selectedId = ids[0];
                    const node = nodes.get(selectedId);
                    clearHighlights(); // Clear previous before applying new
                    if (node) {
                         populateDetailsPanel(node.details || '<p>No details available.</p>');
                         highlightNetworkNode(selectedId); // Highlight node and direct edges
                        if (node.timelineId && timelineItems.get(node.timelineId)) {
                            highlightTimelineItem(node.timelineId);
                            // Optionally center timeline on the highlighted item
                            timeline.focus(node.timelineId, { animation: true });
                        }
                        lastSelectedNodeId = selectedId;
                        lastSelectedItemId = node.timelineId || null;
                    }
                }
            }
             function handleNetworkDeselect(params){
                  // Only clear if the deselect wasn't immediately followed by a select (handled in select handlers)
                 // Or clear if triggered by empty space click (handled in click handler)
             }

            function setupEventListeners() {
                // Controls
                zoomInBtn.onclick = () => network?.zoomIn();
                zoomOutBtn.onclick = () => network?.zoomOut();
                resetViewBtn.onclick = () => network?.fit();
                filterSelect.onchange = handleFilterChange;
                contrastToggleBtn.onclick = () => document.body.classList.toggle('high-contrast');
                 hideDetailsBtn.onclick = toggleDetailsPanel;

                 monthNavContainer.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON' && e.target.dataset.month) {
                        const month = e.target.dataset.month;
                        const year = e.target.dataset.year;
                        const monthIndexMap = { Sep: 8, Oct: 9, Nov: 10, Dec: 11, Jan: 0, Feb: 1, Mar: 2, Apr: 3, May: 4 };
                        const targetDate = new Date(parseInt(year), monthIndexMap[month], 15); // Go to mid-month
                        timeline?.moveTo(targetDate, { animation: true });
                    }
                });

                 // Keyboard Navigation (Timeline focus)
                 timelineContainer.setAttribute('tabindex', '0'); // Make it focusable
                 timelineContainer.addEventListener('keydown', (e) => {
                     if (document.activeElement !== timelineContainer) return; // Only when focused

                     const scrollFactor = 0.1; // Percentage of window to scroll
                     const currentWindow = timeline.getWindow();
                     const interval = currentWindow.end.getTime() - currentWindow.start.getTime();
                     const step = interval * scrollFactor;

                     if (e.key === 'ArrowLeft') {
                         e.preventDefault();
                         timeline.setWindow(currentWindow.start.getTime() - step, currentWindow.end.getTime() - step, { animation: true });
                     } else if (e.key === 'ArrowRight') {
                         e.preventDefault();
                          timeline.setWindow(currentWindow.start.getTime() + step, currentWindow.end.getTime() + step, { animation: true });
                     }
                 });
            }

            function toggleDetailsPanel() {
                 const isHidden = detailsPanel.style.display === 'none';
                 detailsPanel.style.display = isHidden ? 'flex' : 'none';
                 panelResizeHandle.style.display = isHidden ? 'flex' : 'none';
                 hideDetailsBtn.textContent = isHidden ? 'Hide Details ▶' : '◀ Show Details';
                 // Adjust left panel flex dynamically? Or rely on CSS flex properties
                  leftPanel.style.flex = isHidden ? '3' : '1'; // Example adjustment
                 // Refit network after panel toggle
                  setTimeout(() => network?.fit(), 100);
                  setTimeout(() => timeline?.redraw(), 100);
            }


             function handleFilterChange(event) {
                 const value = event.target.value;
                 filterVisualizations(value);
             }

            // --- Filtering Logic ---
             function filterVisualizations(filterValue) {
                 const nodeUpdates = [];
                 const itemUpdates = [];
                 const allNodes = nodes.get({ returnType: 'Array' });
                 const allItems = timelineItems.get({ returnType: 'Array' });

                 allNodes.forEach(node => {
                     const isVisible = checkVisibility(node, filterValue);
                     // Update node visibility/style based on filter
                     // For simplicity, we'll just hide non-matching nodes
                     // More complex: grey out, show connections, etc.
                     nodeUpdates.push({ id: node.id, hidden: !isVisible });
                 });

                 allItems.forEach(item => {
                    const node = item.nodeId ? nodes.get(item.nodeId) : null;
                    const isVisible = checkVisibility(item, filterValue, node); // Pass node for context
                    itemUpdates.push({ id: item.id, visible: isVisible }); // Use timeline's built-in visibility
                 });

                  network.body.data.nodes.update(nodeUpdates);
                  // Hiding nodes automatically hides connected edges in Vis.js
                 timelineItems.update(itemUpdates); // Use update for timeline visibility
             }

            function checkVisibility(element, filterValue, associatedNode = null) {
                if (filterValue === 'all') return true;

                const group = element.group;
                const nodeGroup = associatedNode ? associatedNode.group : null;

                switch (filterValue) {
                     case 'sprout':
                         return group === config.groups.SPROUT || nodeGroup === config.groups.STUDENT_TYPE && associatedNode?.id === 'sprout' || group === config.groups.DELIVERABLE_FALL || group === config.groups.ALL || group === config.groups.MILESTONE || group === config.groups.SUPPORT || group === config.groups.MEETING;
                    case 'fruit':
                         return group === config.groups.FRUIT || nodeGroup === config.groups.STUDENT_TYPE && associatedNode?.id === 'fruit' || group === config.groups.DELIVERABLE_SPRING || group === config.groups.ALL || group === config.groups.MILESTONE || group === config.groups.SUPPORT || group === config.groups.MEETING;
                     case 'allStudents':
                         return group === config.groups.ALL || group === config.groups.MEETING || group === config.groups.MILESTONE || group === config.groups.SUPPORT; // Show things relevant to everyone
                    case 'milestone':
                        return group === config.groups.MILESTONE;
                    case 'deliverable':
                        return group === config.groups.DELIVERABLE_FALL || group === config.groups.DELIVERABLE_SPRING;
                     case 'support':
                        return group === config.groups.SUPPORT || group === config.groups.MEETING;
                    default:
                        return true; // Should not happen
                }
            }


            // --- Highlighting Logic ---
             function clearHighlights() {
                // Clear network selection and styles
                if (network) {
                    network.unselectAll();
                    if (lastSelectedNodeId) {
                        // Reset specific node/edge styles if applied directly
                        // Using classes is generally preferred but this ensures reset
                        try {
                            network.body.data.nodes.update({ id: lastSelectedNodeId, /* reset styles here if needed */ });
                            network.getConnectedEdges(lastSelectedNodeId).forEach(edgeId => {
                                network.body.data.edges.update({ id: edgeId, /* reset styles */ });
                            });
                        } catch (e) { /* Node might have been filtered out */ }
                    }
                }
                 // Clear timeline selection and styles
                 if (timeline) {
                     timeline.setSelection([]); // Clear selection
                    // Remove highlight class from previously highlighted item
                    if (lastSelectedItemId) {
                        const itemElement = timelineContainer.querySelector(`.vis-item[data-id="${lastSelectedItemId}"]`);
                        itemElement?.classList.remove('highlighted-item');
                    }
                 }
                 lastSelectedNodeId = null;
                 lastSelectedItemId = null;
             }

            function highlightTimelineItem(itemId) {
                 if (!timeline || !itemId) return;
                 timeline.setSelection([itemId]); // Select highlights the item by default
                // Add extra class for more prominent highlight
                 const itemElement = timelineContainer.querySelector(`.vis-item[data-id="${itemId}"]`);
                 itemElement?.classList.add('highlighted-item');
                 lastSelectedItemId = itemId; // Track last highlighted
            }

             function highlightNetworkNode(nodeId) {
                 if (!network || !nodeId) return;

                 network.selectNodes([nodeId]); // Basic selection highlight

                 // Enhance highlight (optional - Vis selection is often enough)
                 // network.body.data.nodes.update({id: nodeId, borderWidth: 3, shadow: {enabled: true, size: 10}});
                 // network.getConnectedEdges(nodeId).forEach(edgeId => {
                 //    network.body.data.edges.update({id: edgeId, width: 2.5, shadow: {enabled: true}});
                 // });
                 lastSelectedNodeId = nodeId; // Track last highlighted
             }


            // --- Details Panel Logic ---
             function populateDetailsPanel(content) {
                 detailsContentEl.innerHTML = content;
             }

            // --- Resizer Logic ---
            function initializeResizers() {
                // Vertical Panel Resizer
                let isResizingVertical = false;
                panelResizeHandle.addEventListener('mousedown', (e) => {
                    isResizingVertical = true;
                    document.body.style.cursor = 'ew-resize';
                    document.body.style.userSelect = 'none';
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isResizingVertical) return;
                    const containerRect = document.querySelector('.main-container').getBoundingClientRect();
                    const leftPanelMinWidth = 300; // Minimum width for left panel
                    const rightPanelMinWidth = 200; // Minimum width for right panel

                    const totalWidth = containerRect.width;
                    let leftPanelWidth = e.clientX - containerRect.left;

                    // Enforce minimum widths
                    if (leftPanelWidth < leftPanelMinWidth) {
                        leftPanelWidth = leftPanelMinWidth;
                    }
                    if (totalWidth - leftPanelWidth < rightPanelMinWidth) {
                        leftPanelWidth = totalWidth - rightPanelMinWidth;
                    }

                    const rightPanelWidth = totalWidth - leftPanelWidth;

                    leftPanel.style.flex = `0 0 ${leftPanelWidth}px`;
                    rightPanel.style.flex = `0 0 ${rightPanelWidth}px`;

                    // Trigger redraw/refit after resize
                     network?.setSize('100%', '100%'); // Force network redraw
                });

                document.addEventListener('mouseup', () => {
                    if (isResizingVertical) {
                        isResizingVertical = false;
                        document.body.style.cursor = 'default';
                        document.body.style.userSelect = 'auto';
                         // Ensure final fit after resize stops
                        setTimeout(() => network?.fit(), 50);
                         setTimeout(() => timeline?.redraw(), 50);
                    }
                });

                 // Horizontal Timeline Resizer
                 let isResizingHorizontal = false;
                 timelineResizeHandle.addEventListener('mousedown', (e) => {
                    isResizingHorizontal = true;
                    document.body.style.cursor = 'ns-resize';
                    document.body.style.userSelect = 'none';
                     const startY = e.clientY;
                     const startHeight = timelineVisContainer.offsetHeight;

                     function handleMouseMoveHorizontal(me) {
                         if (!isResizingHorizontal) return;
                          const newHeight = startHeight + (me.clientY - startY);
                          const minHeight = 100;
                          const maxHeight = leftPanel.clientHeight * 0.7; // Max 70% of left panel

                          if (newHeight >= minHeight && newHeight <= maxHeight) {
                              timelineVisContainer.style.height = `${newHeight}px`;
                              // Network container height will adjust via flexbox
                              timeline?.redraw(); // Redraw timeline to fit
                               network?.setSize('100%', '100%'); // Redraw network too
                          }
                     }

                     function handleMouseUpHorizontal() {
                         if (isResizingHorizontal) {
                             isResizingHorizontal = false;
                             document.body.style.cursor = 'default';
                             document.body.style.userSelect = 'auto';
                             document.removeEventListener('mousemove', handleMouseMoveHorizontal);
                             document.removeEventListener('mouseup', handleMouseUpHorizontal);
                         }
                     }

                     document.addEventListener('mousemove', handleMouseMoveHorizontal);
                     document.addEventListener('mouseup', handleMouseUpHorizontal);
                 });
            }

            // --- Start Everything ---
            initializeVisualizations();

        }); // End DOMContentLoaded
    </script>

</body>
</html>