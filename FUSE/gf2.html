<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GENOMIRE SCOPE // Fitts-Optimized Field</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Source+Serif+Pro:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        /* --- 0. THEME & CONFIGURATION --- */
        :root {
            --color-background: #0a0c10;
            --color-text: #c9d1d9;
            --color-glow: hsla(190, 100%, 75%, 0.4);
            --color-focus: hsla(210, 100%, 80%, 0.1);
            --color-selected-glow: hsla(210, 100%, 80%, 0.25);
            --color-grid: rgba(40, 50, 70, 0.2);

            --font-mono: 'Fira Code', monospace;
            --font-serif: 'Source Serif Pro', serif;

            --width-col-edge: 50px;
            --width-col-center: 75px; /* 1.5x */
            --gap-col-center: 16px;
            --height-codon: 48px;
            --width-codon: 36px;
            --scale-hover: 1.05;
            --scale-gaze: 1.1;

            --anim-fast: 150ms;
            --anim-smooth: 350ms;
        }

        /* Codon Type Palettes */
        .type-txt { --codon-color: hsl(210, 50%, 50%); }
        .type-img { --codon-color: hsl(120, 50%, 50%); }
        .type-aud { --codon-color: hsl(280, 50%, 50%); }
        .type-cmd { --codon-color: hsl(30, 80%, 55%); }
        .type-bin { --codon-color: hsl(0, 0%, 60%); }

        /* --- 1. CORE LAYOUT & STRUCTURE --- */
        * { box-sizing: border-box; }

        html { height: 100%; }
        body {
            height: 100%;
            margin: 0;
            background-color: var(--color-background);
            color: var(--color-text);
            font-family: var(--font-mono);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-image:
                linear-gradient(var(--color-grid) 1px, transparent 1px),
                linear-gradient(90deg, var(--color-grid) 1px, transparent 1px);
            background-size: 60px 60px;
        }

        .scope-container {
            width: 100%;
            max-width: 1800px;
            height: 85vh;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #genome-field {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 5vw;
            overflow-x: auto;
            overflow-y: hidden;
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #genome-field::-webkit-scrollbar { display: none; }

        /* --- 2. GENOME COLUMN & STATES --- */
        .genome-column {
            position: relative;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
            height: 98%;
            width: var(--width-col-edge);
            padding: 10px 0;
            border-radius: 6px;
            cursor: pointer;
            scroll-snap-align: center;
            transition:
                width var(--anim-smooth) ease,
                min-width var(--anim-smooth) ease,
                transform var(--anim-fast) ease,
                background-color var(--anim-smooth) ease,
                box-shadow var(--anim-smooth) ease,
                margin-left var(--anim-smooth) ease;
        }

        /* State: Central Zone */
        .genome-column.in-central-zone {
            width: var(--width-col-center);
            margin-left: var(--gap-col-center);
        }

        /* State: Gaze (near viewport center) */
        .genome-column.in-gaze-zone .codon-band {
            transform: scale(var(--scale-gaze));
        }

        /* State: Focus (hover or keyboard) */
        .genome-column.is-focused {
            transform: scale(var(--scale-hover));
            box-shadow: 0 0 25px 5px var(--color-glow);
            background-color: var(--color-focus);
        }
        .genome-column.is-focused .genome-id-tag {
            opacity: 1;
            transform: translateY(-10px);
        }

        /* State: Selected (clicked or 'Enter') */
        .genome-column.is-selected {
            box-shadow: 0 0 1px 1px var(--color-selected-glow), 0 0 25px 5px var(--color-glow);
        }
        
        /* State: Expressed (expanded view) */
        .genome-column.is-expressed {
            min-width: 350px;
            width: auto;
            background-color: rgba(10,12,16,0.8);
            backdrop-filter: blur(5px);
            cursor: default;
            padding: 10px 15px;
            align-items: flex-start;
        }

        /* --- 3. CODON BANDS & CONTENT --- */
        .codon-band {
            width: 100%;
            height: var(--height-codon);
            min-height: var(--height-codon);
            min-width: var(--width-codon);
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 4px;
            user-select: none;
            background-color: var(--codon-color);
            transition: transform var(--anim-fast) ease-out;
            padding: 10px; /* Invisible margin for hit area */
        }
        .codon-band.pulse {
            animation: pulse var(--anim-fast) ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        /* Floating ID Tag */
        .genome-id-tag {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--color-text);
            color: var(--color-background);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            opacity: 0;
            transition: opacity var(--anim-fast), transform var(--anim-fast);
            white-space: nowrap;
        }
        
        /* Expressed Content Styles */
        .expressed-content {
            display: flex;
            align-items: center;
            width: 100%;
            height: var(--height-codon);
            min-height: var(--height-codon);
            padding: 0 5px;
            color: var(--color-text);
            border-left: 2px solid var(--codon-color);
            background: linear-gradient(90deg, hsla(0,0%,0%,0.2), transparent);
        }
        .expressed-content.txt-content {
            font-family: var(--font-serif);
            font-size: 0.8rem;
            line-height: 1.4;
            display: block; /* For multiline */
            white-space: normal;
        }
        .expressed-content.img-content img {
            width: 60px;
            height: 60px;
            min-width: 60px;
            object-fit: cover;
            filter: grayscale(100%);
            margin-right: 10px;
        }
        .expressed-content.aud-content svg {
            stroke: var(--codon-color);
            height: 50%;
        }
        .expressed-content.cmd-content {
            font-size: 1rem;
            gap: 10px;
        }

        /* --- 4. CONSOLE & RADIAL MENU --- */
        #console-container {
            height: 50px;
            padding: 0 5vw;
        }
        #console-input {
            width: 100%;
            background: transparent;
            border: 1px solid rgba(120, 200, 255, 0.2);
            border-radius: 4px;
            color: var(--color-text);
            font-family: var(--font-mono);
            font-size: 1rem;
            padding: 10px 15px;
            outline: none;
            transition: border-color var(--anim-smooth);
        }
        #console-input:focus { border-color: var(--color-glow); }

        #radial-menu {
            position: fixed;
            width: 150px;
            height: 150px;
            opacity: 0;
            pointer-events: none;
            transform: translate(-50%, -50%) scale(0.8);
            transition: opacity var(--anim-fast), transform var(--anim-fast);
        }
        #radial-menu.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, -50%) scale(1);
        }
        .radial-button {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(40, 50, 70, 0.9);
            backdrop-filter: blur(5px);
            color: var(--color-text);
            border-radius: 50%;
            border: 1px solid var(--color-grid);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background-color var(--anim-fast);
        }
        .radial-button:hover { background-color: var(--color-focus); }
        /* Positioning buttons on the circle */
        .radial-button:nth-child(1) { transform: rotate(0deg)   translate(75px) rotate(0deg); }
        .radial-button:nth-child(2) { transform: rotate(90deg)  translate(75px) rotate(-90deg); }
        .radial-button:nth-child(3) { transform: rotate(180deg) translate(75px) rotate(-180deg); }
        .radial-button:nth-child(4) { transform: rotate(270deg) translate(75px) rotate(-270deg); }

        /* --- 5. MOBILE & TOUCH OPTIMIZATION --- */
        @media (max-width: 768px) {
            :root {
                --height-codon: 56px;
                --width-codon: 44px;
            }
            .scope-container { height: 80vh; }
            .genome-column {
                flex-grow: 1; /* Allow columns to fill space */
                width: auto;
            }
            /* Disable fixed central zone on mobile, it's all dynamic */
            .genome-column.in-central-zone {
                width: auto;
                margin-left: 0;
            }
        }

    </style>
</head>
<body>

    <div class="scope-container">
        <div id="genome-field"></div>
    </div>

    <div id="console-container">
        <input id="console-input" type="text" placeholder="> Awaiting command...">
    </div>
    
    <div id="radial-menu">
        <div class="radial-button" data-action="express">Express</div>
        <div class="radial-button" data-action="trace">Trace</div>
        <div class="radial-button" data-action="mutate">Mutate</div>
        <div class="radial-button" data-action="collapse">Collapse</div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const genomeField = document.getElementById('genome-field');
        const consoleInput = document.getElementById('console-input');
        const radialMenu = document.getElementById('radial-menu');

        // --- Configuration & State ---
        const TOTAL_GENOMES = 18;
        const CENTRAL_ZONE_START = 6; // Index 6 (Column 7)
        const CENTRAL_ZONE_END = 10;  // Index 10 (Column 11)
        const GAZE_ZONE_RANGE = 2; // ±2 columns from center
        const LONG_PRESS_DURATION = 500; // ms

        let genomes = [];
        let focusedIndex = -1;
        let selectedIndex = -1;
        let expressedIndex = -1;
        let longPressTimer;
        
        // --- Mock Data Generation ---
        const CODON_TYPES = ['TXT', 'IMG', 'AUD', 'CMD', 'BIN'];
        const generateRandomCodons = (count) => Array.from({ length: count }, () => {
            const type = CODON_TYPES[Math.floor(Math.random() * CODON_TYPES.length)];
            return { type: type.toLowerCase(), label: type, content: generateMockContent(type.toLowerCase()) };
        });
        const generateMockContent = (type) => {
            switch(type) {
                case 'txt': return 'Genome sequence G-021 correlates with early Sol system expansion protocols. Data integrity at 98.7%.';
                case 'img': return `https://picsum.photos/seed/${Math.random()}/60/60`;
                case 'aud': return 'M2,h8,q2,2,4,0,t4,0,q2,-2,4,0,t4,0,q2,2,4,0,t4,0,q2,-2,4,0'; // SVG path data
                case 'cmd': return 'EXECUTE:DEFRAG(MEM_BANK_7)';
                default: return 'BINARY PAYLOAD';
            }
        };
        const generateGenomeData = (total) => Array.from({ length: total }, (_, i) => ({
            id: `g-${String(i + 1).padStart(3, '0')}`,
            codons: generateRandomCodons(8)
        }));

        // --- 1. FIELD RENDERING ---
        function renderField() {
            genomeField.innerHTML = '';
            genomes.forEach((genome, index) => {
                const columnEl = document.createElement('div');
                columnEl.className = 'genome-column';
                columnEl.dataset.index = index;
                if (index >= CENTRAL_ZONE_START && index <= CENTRAL_ZONE_END) {
                    columnEl.classList.add('in-central-zone');
                }
                
                const tagEl = document.createElement('div');
                tagEl.className = 'genome-id-tag';
                tagEl.textContent = genome.id;
                columnEl.appendChild(tagEl);

                columnEl.appendChild(renderCodonContainer(genome.codons));
                genomeField.appendChild(columnEl);
            });
        }
        
        function renderCodonContainer(codons) {
            const container = document.createElement('div');
            container.className = 'codon-container';
            container.style.cssText = `display:flex; flex-direction:column; gap:4px; width:100%; height:100%;`;
            codons.forEach(codon => {
                const bandEl = document.createElement('div');
                bandEl.className = `codon-band type-${codon.type}`;
                bandEl.textContent = codon.label;
                container.appendChild(bandEl);
            });
            return container;
        }

        // --- 2. CORE INTERACTION LOGIC ---
        function updateFocusAndSelection() {
            genomeField.querySelectorAll('.genome-column').forEach((col, i) => {
                col.classList.toggle('is-focused', i === focusedIndex);
                col.classList.toggle('is-selected', i === selectedIndex);
                col.classList.toggle('is-expressed', i === expressedIndex);
            });
        }
        
        function focusColumn(index) {
            if (index < 0 || index >= TOTAL_GENOMES) return;
            focusedIndex = index;
            const columnEl = genomeField.children[index];
            if (columnEl) {
                columnEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
            updateFocusAndSelection();
        }

        function selectColumn(index, fromClick = false) {
            const clickedCodon = fromClick ? event.target.closest('.codon-band') : null;
            if (clickedCodon) {
                clickedCodon.classList.add('pulse');
                setTimeout(() => clickedCodon.classList.remove('pulse'), 150);
            }
            
            selectedIndex = index;
            focusColumn(index);
            consoleInput.value = `> express ${genomes[index].id}`;
            consoleInput.focus();
        }
        
        function expressColumn(index) {
            if (expressedIndex !== -1) collapseColumn(expressedIndex); // Collapse previous
            if (index === -1) return;

            expressedIndex = index;
            selectedIndex = index;
            focusColumn(index);
            
            const columnEl = genomeField.children[index];
            const codonContainer = columnEl.querySelector('.codon-container');
            codonContainer.innerHTML = ''; // Clear old bands

            genomes[index].codons.forEach(codon => {
                const contentEl = document.createElement('div');
                contentEl.className = `expressed-content type-${codon.type}`;
                let innerHTML = '';
                switch (codon.type) {
                    case 'txt': innerHTML = `<div class="txt-content">${codon.content}</div>`; break;
                    case 'img': innerHTML = `<img src="${codon.content}" alt="IMG Codon"><span class="label">${codon.label}</span>`; break;
                    case 'aud': innerHTML = `<svg viewBox="0 0 100 20" preserveAspectRatio="none"><path d="${codon.content}" fill="none" stroke-width="2"/></svg>`; break;
                    case 'cmd': innerHTML = `<span class="cmd-content">§ ${codon.content}</span>`; break;
                    default: innerHTML = `<span>${codon.label}: ${codon.content}</span>`; break;
                }
                contentEl.innerHTML = innerHTML;
                codonContainer.appendChild(contentEl);
            });

            updateFocusAndSelection();
            columnEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }

        function collapseColumn(index) {
            if (index === -1) return;
            expressedIndex = -1;
            const columnEl = genomeField.children[index];
            const codonContainer = columnEl.querySelector('.codon-container');
            codonContainer.replaceWith(renderCodonContainer(genomes[index].codons));
            updateFocusAndSelection();
        }

        // --- 3. EVENT HANDLERS ---

        // Gaze-Aligned Motion (on scroll)
        genomeField.addEventListener('scroll', () => {
            const fieldRect = genomeField.getBoundingClientRect();
            const fieldCenter = fieldRect.left + fieldRect.width / 2;

            let centerColIndex = -1;
            let minDistance = Infinity;

            genomeField.querySelectorAll('.genome-column').forEach((col, i) => {
                const colRect = col.getBoundingClientRect();
                const colCenter = colRect.left + colRect.width / 2;
                const distance = Math.abs(fieldCenter - colCenter);

                if (distance < minDistance) {
                    minDistance = distance;
                    centerColIndex = i;
                }
            });
            
            genomeField.querySelectorAll('.genome-column').forEach((col, i) => {
                 const isGazeTarget = Math.abs(i - centerColIndex) <= GAZE_ZONE_RANGE;
                 col.classList.toggle('in-gaze-zone', isGazeTarget);
            });
        }, { passive: true });

        // Click Selection
        genomeField.addEventListener('click', (e) => {
            const column = e.target.closest('.genome-column');
            if (column && expressedIndex !== +column.dataset.index) {
                selectColumn(+column.dataset.index, true);
            }
        });

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (document.activeElement === consoleInput) return; // Don't interfere with typing
            if (e.key === 'ArrowRight') {
                e.preventDefault();
                focusColumn(focusedIndex < TOTAL_GENOMES - 1 ? focusedIndex + 1 : 0);
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                focusColumn(focusedIndex > 0 ? focusedIndex - 1 : TOTAL_GENOMES - 1);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (focusedIndex !== -1) expressColumn(focusedIndex);
            }
        });
        
        // Console Commands
        consoleInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const command = e.target.value.replace('>', '').trim();
                if (command.startsWith('express g-')) {
                    const id = command.split(' ')[1];
                    const index = genomes.findIndex(g => g.id === id);
                    if (index !== -1) expressColumn(index);
                } else if (command === 'collapse') {
                    if (expressedIndex !== -1) collapseColumn(expressedIndex);
                    e.target.value = '';
                }
            }
        });

        // Hover for Floating ID Tag
        genomeField.addEventListener('mouseover', e => {
            const column = e.target.closest('.genome-column');
            if (column) focusColumn(+column.dataset.index);
        });

        // Long-press & Radial Menu
        const handleLongPress = (e) => {
            const column = e.target.closest('.genome-column');
            if (!column) return;
            const index = +column.dataset.index;
            selectColumn(index);
            
            radialMenu.style.left = `${e.clientX || e.touches[0].clientX}px`;
            radialMenu.style.top = `${e.clientY || e.touches[0].clientY}px`;
            radialMenu.dataset.targetIndex = index;
            radialMenu.classList.add('visible');
        };

        genomeField.addEventListener('mousedown', e => {
            if (e.button !== 0) return; // Only left click
            longPressTimer = setTimeout(() => handleLongPress(e), LONG_PRESS_DURATION);
        });
        genomeField.addEventListener('mouseup', () => clearTimeout(longPressTimer));
        genomeField.addEventListener('mouseout', () => clearTimeout(longPressTimer));
        
        genomeField.addEventListener('touchstart', e => {
            longPressTimer = setTimeout(() => { e.preventDefault(); handleLongPress(e); }, LONG_PRESS_DURATION);
        }, { passive: true });
        genomeField.addEventListener('touchend', () => clearTimeout(longPressTimer));
        genomeField.addEventListener('touchmove', () => clearTimeout(longPressTimer));

        radialMenu.addEventListener('click', (e) => {
            const button = e.target.closest('.radial-button');
            if (!button) return;
            const action = button.dataset.action;
            const index = +radialMenu.dataset.targetIndex;
            
            if (action === 'express') expressColumn(index);
            if (action === 'collapse') collapseColumn(expressedIndex);
            if (action === 'trace' || action === 'mutate') {
                consoleInput.value = `> ${action} ${genomes[index].id}`;
                consoleInput.focus();
            }
            radialMenu.classList.remove('visible');
        });
        
        // Hide radial menu on outside click
        document.addEventListener('click', (e) => {
            if (!radialMenu.contains(e.target) && !e.target.closest('.genome-column')) {
                 radialMenu.classList.remove('visible');
            }
        });

        // --- INITIALIZATION ---
        function initialize() {
            genomes = generateGenomeData(TOTAL_GENOMES);
            renderField();
            focusColumn(Math.floor(TOTAL_GENOMES / 2));
            // Trigger a scroll event to set initial gaze highlights
            genomeField.dispatchEvent(new CustomEvent('scroll'));
        }

        initialize();
    });
    </script>
</body>
</html>