<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECD // GLYPHTRAN // MODEL S-78</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Teko:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /*
        *   ARTIFACT: GLYPHTRAN - Symbolic Language to Plain Speech Converter
        *   DIVISION: ESOTERICA CYBERNETICS (ECD)
        *   FUNCTION: A system for multi-layer translation of ritualistic or
        *   encoded language into direct prose with symbolic and cultural annotation.
        */

        :root {
            --gt-bg: #2c3138;
            --gt-panel: #e0e5e9;
            --gt-panel-dark: #b8c0c8;
            --gt-text-dark: #1a1c20;
            --gt-text-light: #f0f5f9;
            --gt-accent: #3d7a99;
            --gt-accent-warn: #c7883f;
            --font-main: 'Share Tech Mono', monospace;
            --font-display: 'Teko', sans-serif;
        }

        /* --- KEYFRAMES --- */
        @keyframes progress-bar-anim { from { width: 0%; } to { width: 100%; } }
        
        /* --- BASE LAYOUT --- */
        body {
            background-color: #111; display: flex; align-items: center; justify-content: center;
            height: 100vh; margin: 0; font-family: var(--font-main);
            color: var(--gt-text-dark); user-select: none;
        }
        #glyphtran-chassis {
            width: 1600px; height: 900px; background-color: var(--gt-bg);
            border: 1px solid #777; box-shadow: 0 0 30px rgba(61, 122, 153, 0.2);
            padding: 20px; display: grid; grid-template-columns: 350px 1fr 400px;
            gap: 20px;
        }
        
        /* --- PANELS & MODULES --- */
        .panel {
            background-color: var(--gt-panel); padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2); display: flex; flex-direction: column;
        }
        .module-label {
            font-family: var(--font-display); font-size: 2rem; letter-spacing: 1px;
            text-align: center; border-bottom: 2px solid var(--gt-panel-dark);
            padding-bottom: 5px; margin: 0 0 15px 0;
        }

        /* --- LEFT PANEL: INPUT --- */
        #left-panel { grid-column: 1 / 2; }
        #manuscript-bay { flex-grow: 1; overflow-y: auto; }
        .manuscript-button {
            width: 100%; background: #d0d8e0; border: 1px solid #888;
            padding: 12px; font-size: 1.1rem; margin-bottom: 8px; cursor: pointer;
            text-align: left; transition: all 0.2s;
        }
        .manuscript-button:hover { background-color: #f0f5f9; }
        .manuscript-button.active { background-color: var(--gt-accent); color: var(--gt-text-light); }
        
        #transcribe-module { margin-top: auto; }
        #progress-bar-container { width: 100%; height: 20px; background: #555; border: 1px solid #111; margin-bottom: 10px; }
        #progress-bar { width: 0%; height: 100%; background: var(--gt-accent); }
        #transcribe-button {
            width: 100%; background: var(--gt-panel-dark); border: 2px solid #555;
            color: var(--gt-text-dark); padding: 15px; font-size: 1.5rem;
            font-family: var(--font-display); letter-spacing: 1px; cursor: pointer;
        }
        #transcribe-button:disabled { background: #888; color: #555; cursor: not-allowed; }

        /* --- CENTER PANEL: TRANSLATION MATRIX --- */
        #center-panel { grid-column: 2 / 3; padding: 0; overflow: hidden; }
        #matrix-container { width: 100%; height: 100%; overflow-y: auto; }
        #translation-matrix {
            width: 100%; border-collapse: collapse; font-size: 0.95rem;
        }
        #translation-matrix th {
            position: sticky; top: 0; background: var(--gt-panel-dark); padding: 12px;
            font-family: var(--font-display); font-size: 1.3rem; letter-spacing: 1px;
        }
        #translation-matrix td {
            padding: 10px; border-bottom: 1px solid var(--gt-panel-dark);
            vertical-align: top;
        }
        #translation-matrix tbody tr:hover { background-color: #f0f5f9; }
        .col-original { font-family: 'Times New Roman', serif; font-style: italic; color: #444; }
        .col-symbolic { color: var(--gt-accent); }
        .col-notes { font-size: 0.9rem; }
        .untranslatable-term {
            background: var(--gt-accent-warn); padding: 0 4px; border-radius: 3px;
            color: #000; font-weight: bold;
        }

        /* --- RIGHT PANEL: GLOSSARY --- */
        #right-panel { grid-column: 3 / 4; }
        #glossary-content { flex-grow: 1; background: #fff; border: 1px solid #ccc; padding: 15px; overflow-y: auto; }
        .glossary-entry { display: none; }
        .glossary-entry.active { display: block; }
        .glossary-term {
            font-family: var(--font-display); font-size: 2rem; border-bottom: 2px solid #000;
            margin-bottom: 10px; color: var(--gt-accent);
        }
        .glossary-type { font-style: italic; color: #666; margin-bottom: 10px; }
        .glossary-desc { line-height: 1.6; }
    </style>
</head>
<body>
    <div id="glyphtran-chassis">
        <!-- LEFT PANEL -->
        <div class="panel" id="left-panel">
            <h2 class="module-label">SOURCE MANIFOLD</h2>
            <div id="manuscript-bay"></div>
            <div id="transcribe-module">
                <h2 class="module-label" style="font-size:1.2rem; border:none; margin-bottom: 10px;">TRANSCRIPTION PROGRESS</h2>
                <div id="progress-bar-container"><div id="progress-bar"></div></div>
                <button id="transcribe-button" disabled>TRANSCRIBE</button>
            </div>
        </div>

        <!-- CENTER PANEL -->
        <div class="panel" id="center-panel">
            <div id="matrix-container">
                <table id="translation-matrix">
                    <thead>
                        <tr>
                            <th>Original</th>
                            <th>Literal Prose</th>
                            <th>Symbolic Meaning</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4" style="text-align:center; padding: 50px; color: #777;">LOAD MANUSCRIPT AND INITIATE TRANSCRIPTION.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- RIGHT PANEL -->
        <div class="panel" id="right-panel">
            <h2 class="module-label">GLOSSARY / ANNOTATION</h2>
            <div id="glossary-content">
                <div style="text-align:center; color: #777; padding-top: 20px;">Hover over a translated row to view detailed annotations.</div>
            </div>
        </div>
    </div>

<script>
const Glyphtran = {
    // --- Data ---
    MANUSCRIPTS: [
        {
            name: "Decree of Silent Penance",
            lines: [
                { original: "Let the vessel be emptied.", literal: "The subject must be silent.", symbolic: "Purification of intent through negation of self-expression.", notes: "High Affective Resonance." },
                { original: "The mirror must not show a face.", literal: "The subject must not look at their reflection.", symbolic: "Rejection of ego and personal identity.", notes: "Term: <span class='untranslatable-term'>Anopsis</span>." },
                { original: "Observe the weight of unspoken words.", literal: "Consider the consequences of not speaking.", symbolic: "The potential energy of withheld action is a form of tribute.", notes: "" },
                { original: "Only then may the vessel be refilled.", literal: "The subject may speak again.", symbolic: "Reintegration into the community after ego-death.", notes: "" }
            ]
        },
        {
            name: "The Architect's Invocation",
            lines: [
                { original: "We draw the First Line upon the Void.", literal: "The project plan is started.", symbolic: "An act of creation; imposing order on chaos.", notes: "" },
                { original: "It is aligned with the <span class='untranslatable-term'>Chronomagnetic</span> North.", literal: "The project is aligned with the deadline.", symbolic: "Acknowledging temporal constraints as a foundational, cosmic force.", notes: "Term: <span class='untranslatable-term'>Chronomagnetic</span>." },
                { original: "We raise the walls against entropy.", literal: "We define the scope and prevent scope creep.", symbolic: "The project structure is a fortress against chaotic influence and decay.", notes: "High Affective Resonance." },
                { original: "The keystone is placed in synergy.", literal: "The core feature is integrated.", symbolic: "The central, load-bearing concept that gives the entire structure meaning.", notes: "" }
            ]
        }
    ],
    GLOSSARY: {
        'Anopsis': { type: 'Ritual Concept', desc: 'A state of deliberate non-self-reflection, considered a high form of discipline. Believed to sever the ego-feedback loop, allowing for objective self-assessment by proxy through the community.' },
        'Chronomagnetic': { type: 'Metaphysical Term', desc: 'The perceived universal constant that governs project timelines and deadlines. Ritual alignment with this "pole" is believed to ensure timely completion and prevent temporal drift.' }
    },

    // --- DOM Elements ---
    elems: {
        bay: document.getElementById('manuscript-bay'),
        transcribeBtn: document.getElementById('transcribe-button'),
        progressBar: document.getElementById('progress-bar'),
        matrixBody: document.querySelector('#translation-matrix tbody'),
        glossary: document.getElementById('glossary-content'),
    },
    
    // --- State ---
    state: {
        selectedManuscriptId: null,
        isTranscribing: false,
    },
    
    // --- Audio ---
    audio: {
        ctx: null, click: null, transcribe: null,
        init() { this.ctx = new (window.AudioContext||window.webkitAudioContext)();
            this.click = this.createSound(1000, 0.05, 0.2);
            let transOsc = this.ctx.createOscillator(), transGain = this.ctx.createGain();
            transOsc.type='sawtooth'; transOsc.frequency.value=40;
            transGain.gain.value=0;
            transOsc.connect(transGain); transGain.connect(this.ctx.destination); transOsc.start();
            this.transcribe = (on) => transGain.gain.setTargetAtTime(on ? 0.03 : 0, this.ctx.currentTime, 0.1);
        },
        createSound(freq, dur, vol) { return () => { if(!this.ctx) return;
            const o=this.ctx.createOscillator(), g=this.ctx.createGain(); o.connect(g);g.connect(this.ctx.destination);
            o.type='sine'; o.frequency.setValueAtTime(freq,this.ctx.currentTime);
            g.gain.setValueAtTime(vol,this.ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001,this.ctx.currentTime+dur); o.start();o.stop(this.ctx.currentTime+dur); };
        }
    },

    // --- Initialization ---
    init() {
        this.audio.init();
        this.renderBay();
        this.addEventListeners();
    },

    renderBay() {
        this.elems.bay.innerHTML = this.MANUSCRIPTS.map((m, i) => 
            `<button class="manuscript-button" data-id="${i}">${m.name}</button>`
        ).join('');
    },
    
    addEventListeners() {
        this.elems.bay.addEventListener('click', e => {
            if (e.target.matches('.manuscript-button')) this.selectManuscript(parseInt(e.target.dataset.id));
        });
        this.elems.transcribeBtn.onclick = () => this.startTranscription();
    },

    // --- Core Logic ---
    selectManuscript(id) {
        if (this.state.isTranscribing) return;
        this.audio.click();
        this.state.selectedManuscriptId = id;
        document.querySelectorAll('.manuscript-button').forEach(b => b.classList.remove('active'));
        document.querySelector(`.manuscript-button[data-id="${id}"]`).classList.add('active');
        this.elems.transcribeBtn.disabled = false;
    },

    startTranscription() {
        if (this.state.selectedManuscriptId === null || this.state.isTranscribing) return;
        
        this.state.isTranscribing = true;
        this.elems.transcribeBtn.disabled = true;
        this.elems.progressBar.style.transition = 'none';
        this.elems.progressBar.style.width = '0%';
        this.elems.matrixBody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 50px; color: #777;">TRANSCRIBING...</td></tr>';
        this.audio.transcribe(true);
        
        // Animate progress bar
        setTimeout(() => {
            this.elems.progressBar.style.transition = 'width 2s ease-out';
            this.elems.progressBar.style.width = '100%';
        }, 100);

        // Simulate processing time
        setTimeout(() => {
            this.renderMatrix(this.MANUSCRIPTS[this.state.selectedManuscriptId]);
            this.state.isTranscribing = false;
            this.elems.transcribeBtn.disabled = this.state.selectedManuscriptId === null;
            this.audio.transcribe(false);
        }, 2100);
    },
    
    renderMatrix(manuscript) {
        this.elems.matrixBody.innerHTML = manuscript.lines.map((line, i) => `
            <tr data-line-index="${i}">
                <td class="col-original">${line.original}</td>
                <td>${line.literal}</td>
                <td class="col-symbolic">${line.symbolic}</td>
                <td class="col-notes">${line.notes}</td>
            </tr>
        `).join('');

        this.addMatrixRowListeners();
    },
    
    addMatrixRowListeners() {
        this.elems.matrixBody.querySelectorAll('tr').forEach(row => {
            row.addEventListener('mouseenter', e => {
                const lineIndex = parseInt(e.currentTarget.dataset.lineIndex);
                this.renderGlossaryForLine(lineIndex);
            });
        });
    },

    renderGlossaryForLine(lineIndex) {
        this.elems.glossary.innerHTML = ''; // Clear previous
        const line = this.MANUSCRIPTS[this.state.selectedManuscriptId].lines[lineIndex];

        // Find untranslatable terms in the line
        const termsFound = Object.keys(this.GLOSSARY).filter(term => line.original.includes(term) || line.notes.includes(term));
        
        if (termsFound.length === 0) {
            this.elems.glossary.innerHTML = '<div>No special terms detected in this line.</div>';
            return;
        }

        termsFound.forEach(term => {
            const entry = this.GLOSSARY[term];
            const entryEl = document.createElement('div');
            entryEl.className = 'glossary-entry active';
            entryEl.innerHTML = `
                <div class="glossary-term">☍ ${term}</div>
                <div class="glossary-type">${entry.type}</div>
                <div class="glossary-desc">${entry.desc}</div>
            `;
            this.elems.glossary.appendChild(entryEl);
        });
    }
};

Glyphtran.init();
</script>
</body>
</html>