<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>TempoOS — The Rhythm Mediator</title>
  <style>
    :root{
      --bg:#10141A; --canvas:#F9F9F9; --hot:#FF6B35; --cool:#36CFC9; --deep:#0A0D12;
    }
    *, *::before, *::after {box-sizing:border-box}
    html,body{height:100%;margin:0;overscroll-behavior:none}
    body{
      background:linear-gradient(180deg, var(--bg) 0%, var(--deep) 100%);
      color:var(--canvas);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, monospace;
      overflow:hidden;
      -webkit-font-smoothing: antialiased;
    }

    #hero{
      position:fixed;inset:0;display:grid;place-items:center;z-index:50;
      background:radial-gradient(circle at 50% 40%, rgba(255,107,53,0.04) 0%, transparent 70%),
                 linear-gradient(180deg, #0e1218 0%, var(--bg) 100%);
      transition:opacity .9s ease}
    #hero.hidden{opacity:0;pointer-events:none}
    .brand{display:flex;flex-direction:column;align-items:center;gap:.5rem;text-align:center;padding:1rem;}
    .tagline{letter-spacing:.25em;text-transform:uppercase;font-weight:400;font-size:min(3vw,0.85rem);
        color:var(--hot);opacity:.8;margin-bottom: .8em;}
    .title{letter-spacing:.35em;text-transform:uppercase;font-weight:800;font-size:min(13vw,4rem);color:var(--canvas);opacity:.92;}
    .subtitle{letter-spacing:.22em;color:var(--cool);font-size:.9rem}
    .cta{
      margin-top:1.25rem;padding:.9rem 1.25rem;border-radius:999px;
      text-transform:uppercase;letter-spacing:.22em;font-weight:700;cursor:pointer;
      border:1px solid var(--hot);background:linear-gradient(145deg,#1a1e28,var(--bg));
      box-shadow:0 6px 26px rgba(0,0,0,.45), 0 0 20px rgba(255,107,53,0.15);
      color:var(--canvas);transition:all .25s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .cta:hover{transform:translateY(-2px);box-shadow:0 10px 36px rgba(0,0,0,.55), 0 0 30px rgba(255,107,53,0.25)}

    #stage{position:fixed;inset:0}

    .control-panel{
        position:fixed;
        left:50%;
        transform:translateX(-50%);
        width:min(92vw,420px);
        z-index:40;
        opacity:0;
        transition:opacity .9s ease .3s;
        display:grid;
        gap:.75rem;
        padding-bottom: 1rem;
    }
    .control-panel.visible{opacity:1}

    #panel{ top:clamp(10px,6vh,38px); }

    .panel-frame{
      background:linear-gradient(145deg,#14181f,var(--bg));
      border:1px solid var(--hot);
      border-radius:8px;
      padding:1rem;
      box-shadow:0 8px 26px rgba(0,0,0,.55), 0 0 20px rgba(255,107,53,0.12);
    }
    .panel-head{display:flex;align-items:center;justify-content:space-between;padding:.6rem .9rem;border:1px solid var(--hot);border-radius:14px;background:linear-gradient(145deg,#14181f,var(--bg));color:var(--hot);box-shadow:0 0 15px rgba(255,107,53,0.15)}
    .panel-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}
    @media (max-width:500px){.panel-grid{grid-template-columns:repeat(2,1fr)}}
    .btn{
      padding:.8rem .7rem;border-radius:10px;border:1px solid var(--hot);
      background:linear-gradient(145deg,#1a1e28,var(--bg));color:var(--canvas);
      text-transform:uppercase;letter-spacing:.14em;font-size:.7rem;font-weight:700;
      cursor:pointer;transition:all .25s ease;
      box-shadow:0 0 10px rgba(255,107,53,0.1);
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{border-color:var(--hot);color:var(--hot);box-shadow:0 0 20px rgba(255,107,53,0.3)}
    .btn.active{background:linear-gradient(145deg,var(--hot),#e55a28);color:var(--deep);border-color:var(--hot);box-shadow:0 0 30px rgba(255,107,53,.5)}
    .status{font-family:"IBM Plex Mono",ui-monospace,monospace;font-size:.68rem;color:var(--cool)}
    .quote{text-align:center;font-style:italic;font-size:.72rem;color:var(--cool);min-height:2.5em;}

    .vignette{pointer-events:none;position:fixed;inset:0;background:radial-gradient(120% 85% at 50% 50%,transparent 55%,rgba(16,20,26,.7) 100%)}

    #essayModal {
      position: fixed;inset: 0;background: rgba(10,13,18, 0.95);z-index: 99;
      display: flex;justify-content: center;align-items: center;
      opacity: 0;pointer-events: none;transition: opacity 0.3s ease;padding: 1rem 0;
    }
    #essayModal.visible {opacity: 1;pointer-events: auto;}
    .essay-page {
      max-width: 760px;width: 90vw;max-height: 90vh;overflow-y: auto;
      background: var(--bg);padding: 2rem;border-radius: 12px;
      box-shadow: 0 10px 40px rgba(255,107,53,0.3);position: relative;
      color: var(--canvas);line-height: 1.6;font-size: 0.95rem;
      border: 1px solid var(--hot);
      display: none;-webkit-overflow-scrolling: touch;
    }
    .essay-page.visible {display: block;}
    .essay-page h1 {color: var(--hot);margin-top: 0;margin-bottom: 1em;font-weight: 800;letter-spacing: 0.1em;text-transform: uppercase;font-size: 1.5rem;text-align: center;}
    .essay-page h2 {color: var(--hot);margin-top: 1.5em;margin-bottom: 0.5em;font-weight: 700;letter-spacing: 0.08em;text-transform: uppercase;font-size: 1.1rem;border-bottom: 1px solid var(--hot);padding-bottom: 0.2em;}
    .essay-page p {margin-bottom: 1em;}
    .essay-page ul {margin: 1em 0; padding-left: 1.5em;}
    .essay-page li {margin-bottom: 0.5em;}
    .essay-page strong {color: var(--hot);}
    #essayClose {
      position: fixed;top: clamp(1rem, 5vh, 2rem);right: clamp(1rem, 5vw, 2rem);
      background: rgba(16,20,26, 0.7);border: 1px solid var(--hot);border-radius: 50%;
      color: var(--hot);font-size: 1.8rem;cursor: pointer;line-height: 1;
      width: 3rem;height: 3rem;display: flex;justify-content: center;align-items: center;
      transition: all 0.2s ease;z-index: 100;-webkit-tap-highlight-color: transparent;
      box-shadow: 0 0 15px rgba(255,107,53,0.3);
    }
    #essayClose:hover {color: var(--canvas);background: var(--hot);box-shadow: 0 0 30px rgba(255,107,53,0.5);}

    .tempo-indicator {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(16,20,26,0.85);
      border: 1px solid var(--cool);
      border-radius: 8px;
      padding: 0.8rem 1.2rem;
      font-family: "IBM Plex Mono", monospace;
      font-size: 0.75rem;
      color: var(--cool);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 45;
      box-shadow: 0 0 20px rgba(54,207,201,0.2);
    }
    .tempo-indicator.visible {
      opacity: 1;
    }
  </style>
</head>
<body>
  <section id="hero" aria-label="Intro">
    <div class="brand">
      <div class="tagline">THE RHYTHM MEDIATOR</div>
      <div class="title">TEMPO OS</div>
      <div class="subtitle">Speed Has Layers</div>
      <button id="enter" class="cta" aria-label="Enter TempoOS">Enter the Highway</button>
    </div>
  </section>

  <div id="stage" role="presentation"></div>

  <div id="panel" class="control-panel">
    <div class="panel-frame">
      <div class="panel-head">
        <div class="status" id="status">Status: Initializing</div>
        <div class="status" id="cycle">Mode: Instant</div>
      </div>
      <div class="panel-grid">
        <button class="btn" data-mode="instant">Instant</button>
        <button class="btn" data-mode="dwell">Dwell</button>
        <button class="btn" data-mode="bloom">Bloom</button>
        <button id="readManual" class="btn">Manual</button>
      </div>
      <div class="quote" id="panelQuote">"Fast paths, deliberate pauses."</div>
    </div>
  </div>

  <div class="tempo-indicator" id="tempoIndicator">
    <div>Tempo Zone: <span id="tempoValue">—</span></div>
    <div>Tick Rate: <span id="tickRate">—</span></div>
  </div>

  <div class="vignette" aria-hidden="true"></div>

  <div id="essayModal">
    <button id="essayClose">&times;</button>
    <div id="mainEssay" class="essay-page visible">
      <h1>TempoOS: The Rhythm Mediator</h1>
      
      <h2>System Architecture</h2>
      <p>TempoOS operates on a fundamental principle: <strong>not all motion requires the same clock</strong>. The system maintains layered tick rates—simultaneous temporal streams running at different speeds, mediated by rhythm tags and contemplative zones.</p>
      
      <h2>The Turtle Procession</h2>
      <p>At the heart of TempoOS lies the surreal break: a highway where traffic has been <em>replaced</em> by a procession of instanced turtles. Each turtle generates a temporal field—a radius within which time itself slows. Enter a turtle's zone and your tick rate drops. Step outside and you accelerate back to highway speed.</p>
      <p>This is not metaphor. The turtles are tempo clocks made manifest. They don't block traffic—they <em>are</em> the traffic, moving at their own deliberate pace while the world rushes around them.</p>
      
      <h2>Core Entities</h2>
      <ul>
        <li><strong>Highway</strong> — The substrate; the default temporal flow</li>
        <li><strong>Turtles</strong> — Instanced rhythm generators; each emits a unique tempo field</li>
        <li><strong>TempoTag</strong> — Metadata attached to objects, defining their temporal layer</li>
        <li><strong>RhythmHooks</strong> — Event handlers that fire at specific tick rates</li>
      </ul>
      
      <h2>Operational Modes</h2>
      <p><strong>Instant Mode:</strong> Default highway speed. No meditation, maximum throughput.</p>
      <p><strong>Dwell Mode:</strong> Create temporary slow zones. Objects within dwells process at reduced tick rates, allowing contemplation.</p>
      <p><strong>Bloom Mode:</strong> Gradual acceleration outward from a center point. Time ripples like expanding circles.</p>
      
      <h2>The Overpass Myth</h2>
      <p>Legend holds that TempoOS emerged from a traffic engineer who watched turtles cross a six-lane highway at dawn. She noticed that drivers who slowed for the turtles arrived at their destinations calmer, more focused. Those who swerved around them arrived faster but frayed.</p>
      <p>She built the first tempo mediator to encode this wisdom: <strong>speed without rhythm is just noise</strong>. True velocity requires knowing when to dwell.</p>
      
      <h2>Tempo Tags Explained</h2>
      <p>Every object in TempoOS carries a tempo tag:</p>
      <ul>
        <li><strong>instant</strong> — Fires every frame; no delay</li>
        <li><strong>dwell</strong> — Fires every 5-10 frames; space for reflection</li>
        <li><strong>bloom</strong> — Fires with exponential decay; moments of expansion</li>
      </ul>
      <p>Change an object's tag and you change its relationship to time itself.</p>
      
      <h2>User Instruction</h2>
      <p>To operate TempoOS, you must accept the fundamental premise: <strong>not all tasks deserve the same tempo</strong>. Some work requires sprint velocity. Other work requires turtle pace. The system doesn't judge—it simply provides the infrastructure for both.</p>
      <p>Tap a turtle to see its tempo field. Long-press the highway to create a dwell zone. Watch how rhythm shapes reality.</p>
      <p class="quote">"Signal is not volume—signal is pattern."</p>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
  (function ensureThree(){
    function boot(){ 
      if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',start); 
      else start(); 
    }
    if(window.THREE) boot();
    else {
      const el = document.createElement('script');
      el.src = "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js";
      el.onload = boot;
      document.head.appendChild(el);
    }
  })();

  function start(){
    const S={mode:'instant', t:0, selectedTurtle:null, turtleSpeed:0.015};

    const stage=document.getElementById('stage');
    const hero=document.getElementById('hero');
    const panel=document.getElementById('panel');
    const statusEl=document.getElementById('status');
    const cycleEl=document.getElementById('cycle');
    const panelQuote = document.getElementById('panelQuote');
    const essayModal = document.getElementById('essayModal');
    const tempoIndicator = document.getElementById('tempoIndicator');

    const scene=new THREE.Scene();
    scene.background = new THREE.Color(0x10141A);
    scene.fog=new THREE.FogExp2(0x10141A,0.08);

    const camera=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,.1,200);
    camera.position.set(0,8,20);
    camera.lookAt(0,0,-10);

    const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
    renderer.setPixelRatio(Math.min(1.5, devicePixelRatio));
    renderer.setSize(innerWidth,innerHeight);
    renderer.shadowMap.enabled=true;
    renderer.shadowMap.type=THREE.PCFSoftShadowMap;
    renderer.toneMapping=THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure=1.1;
    renderer.physicallyCorrectLights = true;
    stage.appendChild(renderer.domElement);

    // Lighting - TempoOS hot/cool palette
    const key=new THREE.DirectionalLight(0xFF6B35,.3);
    key.position.set(-10,15,10);key.castShadow=true;
    key.shadow.mapSize.set(2048,2048);
    key.shadow.camera.left = -40; key.shadow.camera.right = 40;
    key.shadow.camera.top = 40; key.shadow.camera.bottom = -40;
    scene.add(key);

    const fill=new THREE.DirectionalLight(0x36CFC9,.15);
    fill.position.set(10,8,-5);
    scene.add(fill);

    const ambient=new THREE.AmbientLight(0x0A0D12,0.4);
    scene.add(ambient);

    // Highway - three lanes stretching into distance
    const highway = new THREE.Group();
    scene.add(highway);

    const roadMat = new THREE.MeshStandardMaterial({
      color:0x1a1e28,
      roughness:0.85,
      metalness:0.15,
      flatShading:true
    });

    const road = new THREE.Mesh(
      new THREE.PlaneGeometry(12, 100),
      roadMat
    );
    road.rotation.x = -Math.PI/2;
    road.position.y = 0;
    road.receiveShadow = true;
    highway.add(road);

    // Lane markings
    const lineMat = new THREE.MeshBasicMaterial({
      color:0xF9F9F9,
      transparent:true,
      opacity:0.6
    });

    for(let i = 0; i < 20; i++){
      const line = new THREE.Mesh(
        new THREE.PlaneGeometry(0.3, 3),
        lineMat
      );
      line.rotation.x = -Math.PI/2;
      line.position.set(0, 0.01, -5 - i * 5);
      highway.add(line);
    }

    // Overpass
    const overpassMat = new THREE.MeshStandardMaterial({
      color:0x2a2f38,
      roughness:0.7,
      metalness:0.3,
      flatShading:true
    });

    const overpass = new THREE.Mesh(
      new THREE.BoxGeometry(18, 0.8, 4),
      overpassMat
    );
    overpass.position.set(0, 6, -30);
    overpass.castShadow = true;
    overpass.receiveShadow = true;
    scene.add(overpass);

    // Overpass supports
    for(let i = 0; i < 2; i++){
      const support = new THREE.Mesh(
        new THREE.CylinderGeometry(0.4, 0.5, 6, 8),
        overpassMat
      );
      support.position.set((i === 0 ? -7 : 7), 3, -30);
      support.castShadow = true;
      scene.add(support);
    }

    // THE SURREAL BREAK: Turtles instead of cars
    const turtles = new THREE.Group();
    scene.add(turtles);

    const turtleGeometry = new THREE.Group();
    
    // Shell
    const shell = new THREE.Mesh(
      new THREE.SphereGeometry(0.6, 8, 6),
      new THREE.MeshStandardMaterial({
        color:0x4a8a6a,
        roughness:0.9,
        metalness:0.1,
        flatShading:true
      })
    );
    shell.scale.set(1, 0.5, 1.2);
    shell.position.y = 0.3;
    turtleGeometry.add(shell);

    // Head
    const head = new THREE.Mesh(
      new THREE.BoxGeometry(0.3, 0.2, 0.4),
      new THREE.MeshStandardMaterial({
        color:0x5a9a7a,
        roughness:0.85,
        flatShading:true
      })
    );
    head.position.set(0, 0.2, 0.8);
    turtleGeometry.add(head);

    // Legs (simple boxes)
    const legMat = new THREE.MeshStandardMaterial({
      color:0x5a9a7a,
      roughness:0.85,
      flatShading:true
    });

    const legPositions = [
      [-0.4, 0, 0.3],
      [0.4, 0, 0.3],
      [-0.4, 0, -0.3],
      [0.4, 0, -0.3]
    ];

    legPositions.forEach(pos => {
      const leg = new THREE.Mesh(
        new THREE.BoxGeometry(0.15, 0.15, 0.3),
        legMat
      );
      leg.position.set(pos[0], pos[1], pos[2]);
      turtleGeometry.add(leg);
    });

    // Create instanced turtles
    const turtleInstances = [];
    const numTurtles = 6;

    for(let i = 0; i < numTurtles; i++){
      const turtle = turtleGeometry.clone();
      const lane = (i % 3) - 1; // -1, 0, 1
      turtle.position.set(lane * 3.5, 0.15, -10 - i * 12);
      turtle.userData = {
        lane: lane,
        tempoTag: ['instant', 'dwell', 'bloom'][i % 3],
        speed: 0.015,
        dwellRadius: 3 + Math.random() * 2
      };
      turtle.castShadow = true;
      turtle.receiveShadow = true;
      turtles.add(turtle);
      turtleInstances.push(turtle);
    }

    // Tempo field visualizations (rings around turtles)
    const tempoRings = new THREE.Group();
    scene.add(tempoRings);

    turtleInstances.forEach(turtle => {
      const ringGeo = new THREE.TorusGeometry(turtle.userData.dwellRadius, 0.05, 8, 32);
      const ringMat = new THREE.MeshBasicMaterial({
        color: turtle.userData.tempoTag === 'instant' ? 0xFF6B35 : 
               turtle.userData.tempoTag === 'dwell' ? 0x36CFC9 : 0xF9F9F9,
        transparent: true,
        opacity: 0.0,
        side: THREE.DoubleSide
      });
      const ring = new THREE.Mesh(ringGeo, ringMat);
      ring.rotation.x = -Math.PI/2;
      ring.position.copy(turtle.position);
      ring.userData.turtle = turtle;
      tempoRings.add(ring);
    });

    // Ground plane
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(200, 200),
      new THREE.MeshStandardMaterial({
        color:0x0d1015,
        roughness:0.95,
        metalness:0.05,
        flatShading:true
      })
    );
    ground.rotation.x = -Math.PI/2;
    ground.position.y = -0.1;
    ground.receiveShadow = true;
    scene.add(ground);

    // Raycaster for turtle selection
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    function onPointerDown(event){
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(turtles.children, true);

      if(intersects.length > 0){
        let turtle = intersects[0].object;
        while(turtle.parent !== turtles && turtle.parent) turtle = turtle.parent;
        
        if(turtle.parent === turtles){
          S.selectedTurtle = turtle;
          showTempoInfo(turtle);
          
          // Highlight the ring
          tempoRings.children.forEach(ring => {
            ring.material.opacity = ring.userData.turtle === turtle ? 0.3 : 0.05;
          });
        }
      } else {
        S.selectedTurtle = null;
        tempoIndicator.classList.remove('visible');
        tempoRings.children.forEach(ring => {
          ring.material.opacity = 0.05;
        });
      }
    }

    function showTempoInfo(turtle){
      const tag = turtle.userData.tempoTag;
      const tickRate = tag === 'instant' ? '60 fps' : 
                       tag === 'dwell' ? '10-12 fps' : 
                       '30-15 fps (decay)';
      
      document.getElementById('tempoValue').textContent = tag;
      document.getElementById('tickRate').textContent = tickRate;
      tempoIndicator.classList.add('visible');
    }

    renderer.domElement.addEventListener('pointerdown', onPointerDown);

    function setMode(m){
      S.mode=m;
      document.querySelectorAll('.btn[data-mode]').forEach(b=>b.classList.toggle('active',b.dataset.mode===m));

      let quote, status, cycle;
      
      switch(m){
        case 'instant':
          S.turtleSpeed=0.015;
          status='Status: Maximum throughput';
          cycle='Mode: Instant';
          quote='Fast paths, no meditation.';
          break;
        case 'dwell':
          S.turtleSpeed=0.008;
          status='Status: Contemplative zones active';
          cycle='Mode: Dwell';
          quote='Space for reflection.';
          break;
        case 'bloom':
          S.turtleSpeed=0.012;
          status='Status: Rippling outward';
          cycle='Mode: Bloom';
          quote='Time expands from center.';
          break;
      }
      
      statusEl.textContent=status;
      cycleEl.textContent=cycle;
      panelQuote.textContent=quote;
    }

    document.getElementById('enter').addEventListener('click',()=>{
      hero.classList.add('hidden');
      panel.classList.add('visible');
      statusEl.textContent='Status: TempoOS online';
      setTimeout(()=>{statusEl.textContent='Status: Highway active';},1000);
    });

    document.querySelectorAll('.btn[data-mode]').forEach(b=>
      b.addEventListener('click',function(){setMode(this.dataset.mode);})
    );

    document.getElementById('readManual').addEventListener('click',()=>{
      essayModal.classList.add('visible');
    });

    document.getElementById('essayClose').addEventListener('click', () => {
      essayModal.classList.remove('visible');
    });

    let mx=0,my=0;
    addEventListener('pointermove',e=>{
      if(e.pointerType === 'mouse' || e.pointerType === 'pen') {
        mx=(e.clientX/innerWidth-.5)*2;
        my=(e.clientY/innerHeight-.5)*2;
      }
    });

    function animate(){
      requestAnimationFrame(animate);
      
      // Move turtles forward (loop back when off screen)
      turtleInstances.forEach((turtle, i) => {
        turtle.position.z += S.turtleSpeed;
        if(turtle.position.z > 25){
          turtle.position.z = -60;
        }
        
        // Subtle bobbing
        turtle.position.y = 0.15 + Math.sin(S.t * 0.02 + i) * 0.05;
        turtle.rotation.y = Math.sin(S.t * 0.01 + i) * 0.1;
      });

      // Update tempo rings
      tempoRings.children.forEach(ring => {
        ring.position.copy(ring.userData.turtle.position);
        ring.position.y = 0.1;
        
        // Pulse based on tempo tag
        const basePulse = Math.sin(S.t * 0.03) * 0.02;
        ring.scale.set(1 + basePulse, 1, 1 + basePulse);
      });

      // Camera slight parallax
      camera.position.x+=(mx*2-camera.position.x)*.03;
      camera.position.y+=(8-my*1-camera.position.y)*.03;
      camera.lookAt(0,0,-10);
      
      renderer.render(scene, camera);
      S.t+=1;
    }
    animate();

    function onResize(){
      camera.aspect=innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth,innerHeight);
    }
    addEventListener('resize',onResize);

    setMode('instant');
  }
  </script>
</body>
</html>